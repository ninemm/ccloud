<#include "_inc/_layout.html"/>

<#macro css>
    .txt-gray {
        color: #999;
    }
    
    .weui-media-box__desc {
        line-height: 1.4rem;
        height: 1.4rem;
        font-size: .7rem;
    }
    
    .weui-panel__hd {
	    padding: .5rem;
	    color: #000;
	    font-size: .8rem;
	}

</#macro>

<#macro script_import>
    <script src="${CPATH}/static/layer_mobile/layer.js"></script>
</#macro>

<#macro script>
    
    var $form = $("#form");
    
    $(function() {
        
        console.log("${(customerVisit.id)!}");
		console.log("${(taskId)!}");

    })

	function doReject(){
		layer.open({
			type: 2,
			content: '保存中...'
		});
		$.get("${CPATH}/customer/complete?id=${(customerVisit.id)!}&taskId=${(taskId)}&status=0" ,

			function(res){
				if (res.errorCode == 0) {
					$.confirm({
						title: res.message,
						text: '返回列表页？',
						onOK: function () {
							location.href = '${CPATH}/todo/customer'
						},
						onCancel: function () {
							$.closeModal();
						}
					});
				} else {
					$.alert(res.message);
				}
			layer.closeAll();
		})
	};
    
    function doSubmit() {

		layer.open({
			type: 2,
			content: '保存中...'
		});
		$.get("${CPATH}/customer/complete?id=${(customerVisit.id)!}&taskId=${(taskId)}&status=1" ,
			function(res){
				if (res.errorCode == 0) {
					$.confirm({
						title: res.message,
						text: '返回列表页？',
						onOK: function () {
							location.href = '${CPATH}/todo/customer'
						},
						onCancel: function () {
							$.closeModal();
						}
					});
				} else {
					$.alert(res.message);
				}
			layer.closeAll();
		})
    };
    
</#macro>

<@layout>
<div id="customer-add">
<main>
    <section class="weui-panel weui-panel_access order-customer-info">
      <input type="hidden" name="customerVisit.id" value="${(customerVisit.id)!}">
      <div class="weui-cell weui-cell_access">
          <div class="weui-cell__bd">
              <div class="order-customer-info-title">客户名称: </div>
              <input class="txt-gray" value="${(customerVisit.customer_name)!}">
          </div>
      </div>
      <!-- <div class="weui-cell weui-cell_access">
          <div class="weui-cell__bd">
              <div class="order-customer-info-title">客户昵称: </div>
              <input class="txt-gray" value="${(customerVisit.nickname)!'无'}">
          </div>
      </div> -->
      <div class="weui-cell weui-cell_access">
          <div class="weui-cell__bd">
              <div class="order-customer-info-title">联系人: </div>
              <input class="txt-gray" value="${(customerVisit.contact)!}">
          </div>
      </div>
      <div class="weui-cell weui-cell_access">
          <div class="weui-cell__bd">
              <div class="order-customer-info-title">联系电话: </div>
              <input class="txt-gray" value="${(customerVisit.mobile)!}">
          </div>
      </div>
      <div class="weui-cell weui-cell_access select-area">
          <div class="weui-cell__bd">
              <div class="order-customer-info-title">客户类型: </div>
              <input class="txt-gray" value="${(custTypeNames)!}">
          </div>
      </div>
      <div class="weui-cell weui-cell_access">
          <div class="weui-cell__bd">
              <div class="order-customer-info-title">活动名称: </div>
              <input class="txt-gray" value="${DICT_NAME('customerVisit.question_type')}">
          </div>
      </div>
      <div class="weui-cell weui-cell_access">
          <div class="weui-cell__bd">
              <div class="order-customer-info-title">问题类型: </div>
              <input class="txt-gray" value="${DICT_NAME('customerVisit.question_type')}">
          </div>
      </div>
      <div class="weui-cell weui-cell_access">
          <div class="weui-cell__bd">
              <div class="order-customer-info-title">描述: </div>
              <input class="txt-gray" value="${(customerVisit.question_desc)!}">
          </div>
      </div>
  </section>
  <section class="weui-cells weui-cells_form">
      <div class="weui-cell">
          <div class="weui-cell__bd">
              <div class="weui-uploader">
                  <div class="weui-uploader__hd">
                      <p class="weui-uploader__title">附件图片</p>
                      <div class="weui-uploader__info">${(customerVisit.imageList?size)!0}/3</div>
                  </div>
                  <div class="weui-uploader__bd">
                      <ul class="weui-uploader__files">
                      <#if (customerVisit.imageList) ??> 
                      <#list customerVisit.imageList as bean>
                          <li class="weui-uploader__file" style="background-image: url(${bean.savePath})"></li>
                      </#list>
                      </#if>
                      </ul>
                      <!-- <div class="weui-uploader__input-box">
                           <input type="hidden" name="pic" id="pic">
                       </div> -->
                   </div>
               </div>
           </div>
       </div>
   </section>
   <section class="weui-panel weui-panel_access ft14 remark">
       <div class="weui-cell weui-cell_access">
           <div class="weui-cell__bd">
               <span class="icon-map-pin ft16 green"></span>
               <span id="location">${(customerVisit.location)!}</span>
           </div>
       </div>
   </section>
	
	<section class="weui-panel weui-panel_access ft12 remark">
        <div class="weui-cell weui-cell_access space-between">
	        <p>业务员：李明/18611111111</p>
	        <p>2017-10-10 12:20</p>
        </div>
    </section>
    
    <section class="weui-panel weui-panel_access ft14 remark">
        <!-- <div class="weui-cells__title">文本域</div>
        <div class="weui-cells weui-cells_form">
            <div class="weui-cell">
	            <div class="weui-cell__bd">
	                <textarea class="weui-textarea" placeholder="请输入文本" rows="3"></textarea>
	                <div class="weui-textarea-counter"><span>0</span>/200</div>
	            </div>
            </div>
        </div> -->
        <div class="weui-cell weui-cell_access">
	        <div class="weui-cell__bd">
	            <p>建议</p>
	            <textarea class="weui-textarea" name="" id="" rows="10" placeholder="审核建议"></textarea>
	            <div class="weui-textarea-counter"><span>0</span>/200</div>
	        </div>
        </div>
        <div class="weui-cells weui-cells_form">
            <div class="weui-cell">
	            <div class="weui-cell__bd">
		            <div class="weui-uploader">
		                <div class="weui-uploader__hd">
		                    <p class="weui-uploader__title">附件图片</p>
		                    <div class="weui-uploader__info">0/2</div>
		                </div>
		                <div class="weui-uploader__bd">
			                <ul class="weui-uploader__files" id="uploaderFiles">
			                </ul>
			                <div class="weui-uploader__input-box">
			                  <input id="uploaderInput" class="weui-uploader__input" type="file" accept="image/*" multiple="">
			                </div>
		                </div>
		            </div>
	            </div>
            </div>
        </div>
    </section>
    <section class="weui-panel weui-panel_access ft14 remark">
        <div class="weui-cell weui-cell_access">
	        <div class="weui-cell__bd">
	            <span class="icon-map-pin ft16 green"></span>
	            <span id="location">${(customerVisit.location)!'正在定位中...'}</span>
	        </div>
        </div>
    </section>
</main>
<#include "_inc/_goback.html" />
<footer class="weui-footer weui-footer_fixed-bottom ft16">
    <button class="white-button width-50 _submit_btn" onclick="doReject()">拒绝</button>
    <button class="blue-button width-50 _submit_btn" onclick="doSubmit()">通过</button>
</footer>
</div>
</@layout>