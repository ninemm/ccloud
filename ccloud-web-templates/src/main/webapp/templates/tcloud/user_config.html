<#include "_inc/_layout.html"/>
<#macro title>用户配置</#macro>

<#macro css>
    body {
        background: #fcfcfc;
    }
    
    .weui-cells {
	    font-size: 0.8rem;
	}
    
    .weui-cell__ft {
	    font-size: 0.7rem;
	}

	.weui-cells:first-child {
		margin-top: 0;
	}
	#city-picker {
		text-align: right;
		font-size: inherit;
		border: none;
		color: inherit;
	}
</#macro>

<#macro script>
    $(function() {
		$("#city-picker").cityPicker({
			title: "请选择物理区域",
			onClose: function(obj) {
				var areaName = obj.displayValue.join(",");
				$('#areaName').val(areaName);
				$.ajax({     
					type: "POST",     
					url: "${CPATH}/user/alterUser",
					data: {areaName:areaName},      
					contentType:'application/x-www-form-urlencoded; charset=UTF-8',
				});
			}
		});
        var $iosActionsheet = $('#weui-actionsheet');
        var $iosMask = $('#iosMask');

        function hideActionSheet() {
            $iosActionsheet.removeClass('weui-actionsheet_toggle');
            $iosMask.fadeOut(200);
        }

        $iosMask.on('click', hideActionSheet);
        $('#iosActionsheetCancel').on('click', hideActionSheet);
        $("#showIOSActionSheet").on("click", function(){
            $iosActionsheet.addClass('weui-actionsheet_toggle');
            $iosMask.fadeIn(200);
        });
    
    
        //var $androidActionSheet = $('#weui-android-actionsheet');
        //var $androidMask = $androidActionSheet.find('.weui-mask');

        $("#showAndroidActionSheet").on('click', function() {
            $androidActionSheet.fadeIn(200);
            $androidMask.on('click',function () {
                $androidActionSheet.fadeOut(200);
            });
		});
    });
    
    var callback = function(x) {
    }

    function doChange() {
    
        $.actions({
		    actions: [{
			    text: "编辑",
			    onClick: function() {
			      //do something
			    }
		    },{
			    text: "删除",
			    onClick: function() {
			      //do something
			    }
		    }]
	    });
    }
	
	$("#myQR").click(function() {
		Utils.ajax('${CPATH}/user/getQrcode', '',
			function(data){

			layer.open({
				type: 1,
				title: ['我的二维码',
				'border-bottom: 1px solid #eee;height:2rem;line-height:2rem'
				],
				content: '<img src=\'https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket=' + data.ticket +  '\' />' ,
				anim: 'scale',
				className: 'service',
				btn: '关闭'
			});
	
		}
	);

	});
</#macro>

<@layout>
<div class="weui-content">
	<div class="weui-cells">
		<a class="weui-cell weui-cell_access" href="javascript:;">
			<div class="weui-cell__bd">
				<p>账号</p>
			</div>
			<div class="weui-cell__ft">${(user.username)!}</div>
		</a>
	</div>
	<div class="weui-cells">
		<a class="weui-cell weui-cell_access" id ="myQR">
			<div class="weui-cell__bd">
				<p>我的二维码</p>
			</div>
			<div class="weui-cell__ft"></div>
		</a>
	</div>
	<div class="weui-cells">
		<a class="weui-cell weui-cell_access" href="javascript:;">
			<div class="weui-cell__bd">
				<p>新消息通知</p>
			</div>
			<div class="weui-cell__ft"></div>
		</a>
	</div>
	
	<#if session['sellerList']?? && session['sellerList']?size gt 1>
		<div class="weui-cells">
			<a class="weui-cell weui-cell_access" href="${CPATH}/user/choice"> 
				<div class="weui-cell__bd">
					<p>切换账套</p>
				</div>
				<div class="weui-cell__ft">${(session.sellerName)!}</div>
			</a>
		</div>
	</#if>
	
	
	<div class="weui-cells">
		<a class="weui-cell weui-cell_access">
			<div class="weui-cell__bd">
				<p>负责区域设置</p>
			</div>
			<div class="weui-cell__ft">
				<input type="hidden" name="areaName" id="areaName" value="${(user.province+' ')!''}${(user.city+' ')!''}${(user.region)!''}" >
				<input type="text" id="city-picker" class="weui-input" value="${(user.province+' ')!''}${(user.city+' ')!''}${(user.region)!''}" readonly/>
			</div>
		</a>
	</div>
	<!-- <div class="weui-cells">
		<button class="weui-cell weui-cell_access width-100 bg-white">
			<div class="weui-cell__bd">
				<p class="t-c red">退出登录</p>
			</div>
		</button>
	</div> -->
	
	<!-- <div id="actionSheet_wrap"> -->
	    <!-- <div class="weui-mask_transparent actionsheet__mask" id="iosMask"></div>
	    <div class="weui-actionsheet" id="weui-actionsheet">
	        <div class="weui-actionsheet__menu">
	            <#if (session.sellerList)??>
                <#list session.sellerList as bean>
                <div class="weui-actionsheet__cell"><i class="icon-user <#if (bean.seller_id = session.sellerId)>red<#else>gray</#if>"></i> ${(bean.seller_name)!}</div>
                </#list>
                </#if>
	        </div>
	        <div class="weui-actionsheet__action">
	            <div class="weui-actionsheet__cell" id="iosActionsheetCancel">取消</div>
	        </div>
	    </div> -->
	    <!-- <div class="weui-skin_android" id="weui-android-actionsheet" style="display: none">
	        <div class="weui-mask"></div>
	        <div class="weui-actionsheet">
	            <div class="weui-actionsheet__menu">
	                <#if (session.sellerList)??>
			        <#list session.sellerList as bean>
			        <div class="weui-actionsheet__cell"><i class="icon-user <#if (bean.seller_id = session.sellerId)>red<#else>gray</#if>"></i> ${(bean.seller_name)!}</div>
			        </#list>
			        </#if>
	            </div>
	        </div>
	    </div> -->
	<#include "_inc/_goback.html" />    
</div>

</@layout>
