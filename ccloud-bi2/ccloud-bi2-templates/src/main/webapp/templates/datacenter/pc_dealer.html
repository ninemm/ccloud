<#include "_inc/_pc_layout.html"/>
<#macro script_import>
</#macro>
<#macro css_import>
</#macro>
<#macro css>
    #div_dealer_rank{
        overflow-y:scroll;
        max-height: 16rem;
    }
    
    #div_product_rank{
        overflow-y:scroll;
        max-height: 16rem;
    }
</#macro>
<#macro script>

    var CPATH = '${CPATH}';
    var CTPATH = '${CTPATH}';
    var dealerCode = '';
    var dealerName = '';

    function setDateType(type){
        setFilter(type);
        dealer();
    }
    
    //经销商选择
    function setDealer(Code, Name, Area){
        dealerCode = Code;
        dealerName = Name;
        dataArea = Area
        dealer_detail(dealerCode, dealerName, dataArea);
    }
    
    //经销商
    function dealer(){
        Utils.loading();
        $.ajax({
            url:"${CPATH}/biSales/dealer",
            type:"post",
            data:{"provName": provName, "cityName": cityName, countryName: '', startDate: startDate, endDate: endDate, dataArea: dataArea, brandId: brandId},
            dataType:"json"
        }).done(function(data){

            var drTitle = '经销商销售排行';
            if((provName + cityName).trim() != '' ){
                drTitle = provName + cityName + drTitle;
            } else {
                drTitle = '全国' + drTitle;
            }
            var $p = $("#p_dealer_rank");
            $p.empty();
            $p.text(drTitle);

            var $tbody = $("#dealer_rank tbody");
            $tbody.empty();
            for(var i = 0; i < data.length; i++){
                var fun = "setDealer('" + data[i].dealerCode + "'" + "," + "'" + data[i].dealerName + "'," + "'" + data[i].data_area + "')";
                $tbody.append("<tr onclick=" + fun +"><td><a href=\"javascript:void();\">" + data[i].dealerName + "</a></td><td class='t-r'>" + data[i].totalCount + "</td><td class='t-r'>" + data[i].totalAmount + "</td></tr>");
            }
            
            var dataDealerCode = (data[0] != undefined ? data[0].dealerCode : '');
            var dataDealerName = (data[0] != undefined ? data[0].dealerName : '');
            var dataDataArea = (data[0] != undefined ? data[0].data_area : '');

            //调用其他纬度
            dealer_detail(dataDealerCode, dataDealerName, dataDataArea);
       });
    }
    
    //产品
    function dealer_detail(dealerCode, dealerName, selectDataArea){
      Utils.loading();
      $.ajax({
            url:"${CPATH}/biSales/dealerDetail",
            type:"post",
            data:{provName: provName, cityName: cityName, countryName: '', startDate: startDate, endDate: endDate, dataArea: selectDataArea, brandId: brandId},
            dataType:"json"
        }).done(function(data){
            
            var prTitle = dealerName + '产品销售排行';
            var $p = $("#p_product_rank");
            $p.empty();
            $p.text(prTitle);
            
            //产品
            product_rank(data.productList);
       });
    }
    
    //产品
    function product_rank(productList){
        Utils.close();

        var $tbody = $("#product_rank tbody");
        $tbody.empty();
        for(var i = 0; i < productList.length; i++){
            $tbody.append("<tr><td>" + productList[i].cInvName + "</td><td class='t-r'>" + productList[i].totalNum + "</td><td class='t-r'>" + productList[i].totalAmount + "</td></tr>");
        }

    }

    function initData(){
        dealer();
    }

</#macro>
<@layout>
<section>
    <div class="bi-body">
        <div class="row" >
            <div class="col-md-9">
                <#include "_inc/_pc_search_box.html"/>
                <div class="row">

                </div>
            </div>
            <div class="col-md-3">
                <p class="title" id="p_dealer_rank"></p>
                <div id="div_dealer_rank">
                    <table id="dealer_rank" class="table table-striped table-bordered">
                        <thead>
                          <tr>
                            <tr><th>经销商</th><th width="20%">订单数(笔)</th><th width="25%">金额(万元)</th></tr>
                          </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
                <p class="title" id="p_product_rank"></p>
                <div id="div_product_rank">
                    <table id="product_rank" class="table table-striped table-bordered">
                        <thead>
                          <tr>
                            <tr><th>产品</th><th width="20%">数量(件)</th><th width="25%">金额(万元)</th></tr>
                          </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</section>
</@layout>