<#include "_inc/_pc_layout.html"/>
<#macro script_import>
</#macro>
<#macro css_import>
</#macro>
<#macro css>
    #orderNum{
        height: 18rem;
        background: #fff!important;
    }

    #div_dealer_rank{
        overflow-y:scroll;
        max-height: 15.5rem;
    }
    
    #div_product_rank{
        overflow-y:scroll;
        max-height: 15.5rem;
    }

    .div_product_rank{
        margin-top: 5px;
        margin-bottom: 5px;
        background: #fff;
    }
</#macro>
<#macro script>

    var CPATH = '${CPATH}';
    var CTPATH = '${CTPATH}';
    var dealerCode = '';
    var dealerName = '';
    var selectDataArea = '';

    function setDateType(type){
        setFilter(type);
        dealer();
    }
    
    //经销商选择
    function setDealer(Code, Name, Area){
        dealerCode = Code;
        dealerName = Name;
        selectDataArea = Area;
        dealer_detail(dealerCode, dealerName, selectDataArea);
    }
    
    //经销商
    function dealer(){
        Utils.loading();
        $.ajax({
            url:"${CPATH}/biSales/dealer",
            type:"post",
            data:{"provName": provName, "cityName": cityName, countryName: '', startDate: startDate, endDate: endDate, dataArea: dataArea, brandId: brandId},
            dataType:"json"
        }).done(function(data){

            var drTitle = '经销商销售排行';
            if((provName + cityName).trim() != '' ){
                drTitle = provName + cityName + drTitle;
            } else {
                drTitle = '全国' + drTitle;
            }
            var $p = $("#p_dealer_rank");
            $p.empty();
            $p.text(drTitle);

            var $tbody = $("#dealer_rank tbody");
            $tbody.empty();
            for(var i = 0; i < data.length; i++){
                var fun = "setDealer('" + data[i].dealerCode + "'" + "," + "'" + data[i].dealerName + "'," + "'" + data[i].data_area + "')";
                $tbody.append("<tr onclick=" + fun +"><td><a href=\"javascript:void();\">" + data[i].dealerName + "</a></td><td class='t-r'>" + data[i].totalCount + "</td><td class='t-r'>" + data[i].totalAmount + "</td></tr>");
            }
            
            var dataDealerCode = (data[0] != undefined ? data[0].dealerCode : '');
            var dataDealerName = (data[0] != undefined ? data[0].dealerName : '');
            var dataDataArea = (data[0] != undefined ? data[0].data_area : '');

            //调用其他纬度
            dealer_detail(dataDealerCode, dataDealerName, dataDataArea);
       });
    }
    
    //产品
    function dealer_detail(dealerCode, dealerName, selectDataArea){
      Utils.loading();
      $.ajax({
            url:"${CPATH}/biSales/dealerDetail",
            type:"post",
            data:{provName: provName, cityName: cityName, countryName: '', startDate: startDate, endDate: endDate, dataArea: selectDataArea, brandId: brandId},
            dataType:"json"
        }).done(function(data){

            //订单数量
            var oTitle = dealerName + '每日订单数量(单位/笔)';
            orderNum(data.orderNumList, oTitle);
            
            var prTitle = dealerName + '产品销售排行';
            var $p = $("#p_product_rank");
            $p.empty();
            $p.text(prTitle);
            
            //产品
            product_rank(data.productList);
       });
    }
    
    //产品
    function product_rank(productList){
        Utils.close();

        var $tbody = $("#product_rank tbody");
        $tbody.empty();
        for(var i = 0; i < productList.length; i++){
            $tbody.append("<tr><td>" + productList[i].cInvName + "</td><td class='t-r'>" + productList[i].totalNum + "</td><td class='t-r'>" + productList[i].totalAmount + "</td></tr>");
        }

    }

    //订单数量
    function orderNum(data, oTitle){
    
        var xData = [];
        var seriesData = [];
        
        for(var i = 0; i < data.length; i++){
            xData.push(data[i].date) ;
            seriesData.push(data[i].orderNum);
        }
        
        var orderNum = document.getElementById('orderNum');
        
        var orderNumChart = echarts.init(orderNum);
        var option = {
            title: {
                left: 'center',
                top: 'top',
                text: oTitle,
                textStyle: {
                    fontWeight: 'normal',
                    color: '#ea6f5a',
                    fontSize: '.7rem'
                }
            },
            tooltip : {
            },
            grid: {
                left: '13%',
                right: '8%',
                top: '25%'
            },
            xAxis: {
                data: xData
            },
            yAxis: {},
            series: [{
                name: oTitle,
                type: 'line',
                itemStyle: {
                    normal: {color: '#a6c84c'}
                },
                lineStyle: {
                    normal: {color: '#a6c84c'}
                },
                markPoint: {
                    label: {
                        normal: {
                        textStyle: {
                            color: '#000',
                        }
                    }
                },
                data : [
                    {type: 'max', name: '最大值'},
                    {type: 'min', name: '最小值'}
                ]
            },
            data:seriesData
            }]
        };
        orderNumChart.resize();
        orderNumChart.setOption(option, true);
    }

    function initData(){
        dealer();
    }

</#macro>
<@layout>
<section>
    <div class="bi-body">
        <#include "_inc/_pc_nav_box.html"/>
        <div class="row" >
            <div class="col-md-9">
                <#include "_inc/_pc_search_box.html"/>
                <div class="row">
                    <div class="col-md-3">
                    </div>
                    <div class="col-md-9">
                        <div id="orderNum"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="div_product_rank">
                    <p class="title" id="p_dealer_rank"></p>
                    <div id="div_dealer_rank">
                        <table id="dealer_rank" class="table table-striped table-bordered">
                            <thead>
                              <tr>
                                <tr><th>经销商</th><th width="20%">订单数(笔)</th><th width="25%">金额(万元)</th></tr>
                              </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                    <p class="title" id="p_product_rank"></p>
                    <div id="div_product_rank">
                        <table id="product_rank" class="table table-striped table-bordered">
                            <thead>
                              <tr>
                                <tr><th>产品</th><th width="20%">数量(件)</th><th width="25%">金额(万元)</th></tr>
                              </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
</@layout>