<#include "_inc/_layout.html"/>
<#macro css>
	section {
		background: #fff;
	}
	
	.location {
		height: 1rem;
		padding: .2rem;
		color: #ccc;
		font-size: .7rem;
	}
	
	.map-wrapper {
		width: 100%;
	}
	
	.maps {
		width: 100%;
		height: 15rem;
	}
	
	.map-desc {
		text-align: center;
		color: #ccc;
		font-size: .7rem;
		background: #fff;
		padding: .2rem 0;
	}
	
	.stat-title {
		text-align: center;
		line-height: 2rem;
		height: 2rem;
		background: #f2f2f2;
	}
</#macro>

<#macro script_import>
	<script type='text/javascript' src="${CTPATH}/js/echarts.min.js"></script>
	<script type='text/javascript' src="${CTPATH}/js/china.js"></script>
	<script type='text/javascript' src="${CTPATH}/js/countUp.js"></script>
	<script type='text/javascript' src="${CTPATH}/js/common.js"></script>
</#macro>
<#macro script>

	var $map = document.getElementById("map");
	var myChart = echarts.init($map);
	var app = {};
	option = null;
	
	var provName = "婀栧寳鐪�;
	var cityName = "姝︽眽甯�;
	var countryName = "";
	
	var geoCoordMap = {};
	
	$.getJSON('${CTPATH}/mapdata/geometryProvince/42.json', function(data) {
		console.log(data)
		var features = data.features;
		var length = features.length;
		//var map = new Map();
		for (var i = 0; i < length; i++) {
			var property = features[i].properties;
			var name = property.name;
			geoCoordMap[name] = property.cp;
			//map.put(property.name, property.cp);
		}
		console.log(JSON.stringify(obj));
	});

	/**var geoCoordMap = {
	    '涓婃捣': [121.4648, 31.2891],
	    '涓滆帪': [113.8953, 22.901],
	    '涓滆惀': [118.7073, 37.5513],
	    '涓北': [113.4229, 22.478],
	    '涓存本': [111.4783, 36.1615],
	    '涓存矀': [118.3118, 35.2936],
	    '涓逛笢': [124.541, 40.4242],
	    '涓芥按': [119.5642, 28.1854],
	    '涔岄瞾鏈ㄩ綈': [87.9236, 43.5883],
	    '浣涘北': [112.8955, 23.1097],
	    '淇濆畾': [115.0488, 39.0948],
	    '鍏板窞': [103.5901, 36.3043],
	    '鍖呭ご': [110.3467, 41.4899],
	    '鍖椾含': [116.4551, 40.2539],
	    '鍖楁捣': [109.314, 21.6211],
	    '鍗椾含': [118.8062, 31.9208],
	    '鍗楀畞': [108.479, 23.1152],
	    '鍗楁槍': [116.0046, 28.6633],
	    '鍗楅�': [121.1023, 32.1625],
	    '鍘﹂棬': [118.1689, 24.6478],
	    '鍙板窞': [121.1353, 28.6688],
	    '鍚堣偉': [117.29, 32.0581],
	    '鍛煎拰娴╃壒': [111.4124, 40.4901],
	    '鍜搁槼': [108.4131, 34.8706],
	    '鍝堝皵婊�: [127.9688, 45.368],
	    '鍞愬北': [118.4766, 39.6826],
	    '鍢夊叴': [120.9155, 30.6354],
	    '澶у悓': [113.7854, 39.8035],
	    '澶ц繛': [122.2229, 39.4409],
	    '澶╂触': [117.4219, 39.4189],
	    '澶師': [112.3352, 37.9413],
	    '濞佹捣': [121.9482, 37.1393],
	    '瀹佹尝': [121.5967, 29.6466],
	    '瀹濋浮': [107.1826, 34.3433],
	    '瀹胯縼': [118.5535, 33.7775],
	    '甯稿窞': [119.4543, 31.5582],
	    '骞垮窞': [113.5107, 23.2196],
	    '寤婂潑': [116.521, 39.0509],
	    '寤跺畨': [109.1052, 36.4252],
	    '寮犲鍙�: [115.1477, 40.8527],
	    '寰愬窞': [117.5208, 34.3268],
	    '寰峰窞': [116.6858, 37.2107],
	    '鎯犲窞': [114.6204, 23.1647],
	    '鎴愰兘': [103.9526, 30.7617],
	    '鎵窞': [119.4653, 32.8162],
	    '鎵垮痉': [117.5757, 41.4075],
	    '鎷夎惃': [91.1865, 30.1465],
	    '鏃犻敗': [120.3442, 31.5527],
	    '鏃ョ収': [119.2786, 35.5023],
	    '鏄嗘槑': [102.9199, 25.4663],
	    '鏉窞': [119.5313, 29.8773],
	    '鏋ｅ簞': [117.323, 34.8926],
	    '鏌冲窞': [109.3799, 24.9774],
	    '鏍床': [113.5327, 27.0319],
	    '姝︽眽': [114.3896, 30.6628],
	    '姹曞ご': [117.1692, 23.3405],
	    '姹熼棬': [112.6318, 22.1484],
	    '娌堥槼': [123.1238, 42.1216],
	    '娌у窞': [116.8286, 38.2104],
	    '娌虫簮': [114.917, 23.9722],
	    '娉夊窞': [118.3228, 25.1147],
	    '娉板畨': [117.0264, 36.0516],
	    '娉板窞': [120.0586, 32.5525],
	    '娴庡崡': [117.1582, 36.8701],
	    '娴庡畞': [116.8286, 35.3375],
	    '娴峰彛': [110.3893, 19.8516],
	    '娣勫崥': [118.0371, 36.6064],
	    '娣畨': [118.927, 33.4039],
	    '娣卞湷': [114.5435, 22.5439],
	    '娓呰繙': [112.9175, 24.3292],
	    '娓╁窞': [120.498, 27.8119],
	    '娓崡': [109.7864, 35.0299],
	    '婀栧窞': [119.8608, 30.7782],
	    '婀樻江': [112.5439, 27.7075],
	    '婊ㄥ窞': [117.8174, 37.4963],
	    '娼嶅潑': [119.0918, 36.524],
	    '鐑熷彴': [120.7397, 37.5128],
	    '鐜夋邯': [101.9312, 23.8898],
	    '鐝犳捣': [113.7305, 22.1155],
	    '鐩愬煄': [120.2234, 33.5577],
	    '鐩橀敠': [121.9482, 41.0449],
	    '鐭冲搴�: [114.4995, 38.1006],
	    '绂忓窞': [119.4543, 25.9222],
	    '绉︾殗宀�: [119.2126, 40.0232],
	    '缁嶅叴': [120.564, 29.7565],
	    '鑱婂煄': [115.9167, 36.4032],
	    '鑲囧簡': [112.1265, 23.5822],
	    '鑸熷北': [122.2559, 30.2234],
	    '鑻忓窞': [120.6519, 31.3989],
	    '鑾辫姕': [117.6526, 36.2714],
	    '鑿忔辰': [115.6201, 35.2057],
	    '钀ュ彛': [122.4316, 40.4297],
	    '钁姦宀�: [120.1575, 40.578],
	    '琛℃按': [115.8838, 37.7161],
	    '琛㈠窞': [118.6853, 28.8666],
	    '瑗垮畞': [101.4038, 36.8207],
	    '瑗垮畨': [109.1162, 34.2004],
	    '璐甸槼': [106.6992, 26.7682],
	    '杩炰簯娓�: [119.1248, 34.552],
	    '閭㈠彴': [114.8071, 37.2821],
	    '閭兏': [114.4775, 36.535],
	    '閮戝窞': [113.4668, 34.6234],
	    '閯傚皵澶氭柉': [108.9734, 39.2487],
	    '閲嶅簡': [107.7539, 30.1904],
	    '閲戝崕': [120.0037, 29.1028],
	    '閾滃窛': [109.0393, 35.1947],
	    '閾跺窛': [106.3586, 38.1775],
	    '闀囨睙': [119.4763, 31.9702],
	    '闀挎槬': [125.8154, 44.2584],
	    '闀挎矙': [113.0823, 28.2568],
	    '闀挎不': [112.8625, 36.4746],
	    '闃虫硥': [113.4778, 38.0951],
	    '闈掑矝': [120.4651, 36.3373],
	    '闊跺叧': [113.7964, 24.7028]
	};*/
	
	var BJData = [
	    [{
	        name: '鍖椾含'
	    }, {
	        name: '涓婃捣',
	        value: 95
	    }],
	    [{
	        name: '鍖椾含'
	    }, {
	        name: '骞垮窞',
	        value: 90
	    }],
	    [{
	        name: '鍖椾含'
	    }, {
	        name: '澶ц繛',
	        value: 80
	    }],
	    [{
	        name: '鍖椾含'
	    }, {
	        name: '鍗楀畞',
	        value: 70
	    }],
	    [{
	        name: '鍖椾含'
	    }, {
	        name: '鍗楁槍',
	        value: 60
	    }],
	    [{
	        name: '鍖椾含'
	    }, {
	        name: '鎷夎惃',
	        value: 50
	    }],
	    [{
	        name: '鍖椾含'
	    }, {
	        name: '闀挎槬',
	        value: 40
	    }],
	    [{
	        name: '鍖椾含'
	    }, {
	        name: '鍖呭ご',
	        value: 30
	    }],
	    [{
	        name: '鍖椾含'
	    }, {
	        name: '閲嶅簡',
	        value: 20
	    }],
	    [{
	        name: '鍖椾含'
	    }, {
	        name: '甯稿窞',
	        value: 10
	    }]
	];
	
	var SHData = [
	    [{
	        name: '涓婃捣'
	    }, {
	        name: '鍖呭ご',
	        value: 95
	    }],
	    [{
	        name: '涓婃捣'
	    }, {
	        name: '鏄嗘槑',
	        value: 90
	    }],
	    [{
	        name: '涓婃捣'
	    }, {
	        name: '骞垮窞',
	        value: 80
	    }],
	    [{
	        name: '涓婃捣'
	    }, {
	        name: '閮戝窞',
	        value: 70
	    }],
	    [{
	        name: '涓婃捣'
	    }, {
	        name: '闀挎槬',
	        value: 60
	    }],
	    [{
	        name: '涓婃捣'
	    }, {
	        name: '閲嶅簡',
	        value: 50
	    }],
	    [{
	        name: '涓婃捣'
	    }, {
	        name: '闀挎矙',
	        value: 40
	    }],
	    [{
	        name: '涓婃捣'
	    }, {
	        name: '鍖椾含',
	        value: 30
	    }],
	    [{
	        name: '涓婃捣'
	    }, {
	        name: '涓逛笢',
	        value: 20
	    }],
	    [{
	        name: '涓婃捣'
	    }, {
	        name: '澶ц繛',
	        value: 10
	    }]
	];
	
	var GZData = [
	    [{
	        name: '骞垮窞'
	    }, {
	        name: '绂忓窞',
	        value: 95
	    }],
	    [{
	        name: '骞垮窞'
	    }, {
	        name: '澶師',
	        value: 90
	    }],
	    [{
	        name: '骞垮窞'
	    }, {
	        name: '闀挎槬',
	        value: 80
	    }],
	    [{
	        name: '骞垮窞'
	    }, {
	        name: '閲嶅簡',
	        value: 70
	    }],
	    [{
	        name: '骞垮窞'
	    }, {
	        name: '瑗垮畨',
	        value: 60
	    }],
	    [{
	        name: '骞垮窞'
	    }, {
	        name: '鎴愰兘',
	        value: 50
	    }],
	    [{
	        name: '骞垮窞'
	    }, {
	        name: '甯稿窞',
	        value: 40
	    }],
	    [{
	        name: '骞垮窞'
	    }, {
	        name: '鍖椾含',
	        value: 30
	    }],
	    [{
	        name: '骞垮窞'
	    }, {
	        name: '鍖楁捣',
	        value: 20
	    }],
	    [{
	        name: '骞垮窞'
	    }, {
	        name: '娴峰彛',
	        value: 10
	    }]
	];
	
	var planePath = 'path://M1705.06,1318.313v-89.254l-319.9-221.799l0.073-208.063c0.521-84.662-26.629-121.796-63.961-121.491c-37.332-0.305-64.482,36.829-63.961,121.491l0.073,208.063l-319.9,221.799v89.254l330.343-157.288l12.238,241.308l-134.449,92.931l0.531,42.034l175.125-42.917l175.125,42.917l0.531-42.034l-134.449-92.931l12.238-241.308L1705.06,1318.313z';
	
	var convertData = function(data) {
	    var res = [];
	    //console.log(JSON.stringify(data))
	    for (var i = 0; i < data.length; i++) {
	        var dataItem = data[i];
	        var fromCoord = geoCoordMap[dataItem[0].name];
	        //console.log(fromCoord)
	        var toCoord = geoCoordMap[dataItem[1].name];
	        if (fromCoord && toCoord) {
	            res.push([{
	                coord: fromCoord
	            }, {
	                coord: toCoord
	            }]);
	        }
	    }
	    return res;
	};
	
	var color = ['#a6c84c', '#ffa022', '#46bee9'];
	var series = [];
	[
	    ['鍖椾含', BJData],
	    ['涓婃捣', SHData],
	    ['骞垮窞', GZData]
	].forEach(function(item, i) {
	    series.push({
	        name: item[0] + ' Top10',
	        type: 'lines',
	        zlevel: 1,
	        effect: {
	            show: true,
	            period: 6,
	            trailLength: 0.7,
	            color: '#fff',
	            symbolSize: 3
	        },
	        lineStyle: {
	            normal: {
	                color: color[i],
	                width: 0,
	                curveness: 0.2
	            }
	        },
	        data: convertData(item[1])
	    }, {
	        name: item[0] + ' Top10',
	        type: 'lines',
	        zlevel: 2,
	        effect: {
	            show: true,
	            period: 6,
	            trailLength: 0,
	            symbol: planePath,
	            symbolSize: 15
	        },
	        lineStyle: {
	            normal: {
	                color: color[i],
	                width: 1,
	                opacity: 0.4,
	                curveness: 0.2
	            }
	        },
	        data: convertData(item[1])
	    }, {
	        name: item[0] + ' Top10',
	        type: 'effectScatter',
	        coordinateSystem: 'geo',
	        zlevel: 2,
	        rippleEffect: {
	            brushType: 'stroke'
	        },
	        label: {
	            normal: {
	                show: true,
	                position: 'right',
	                formatter: '{b}'
	            }
	        },
	        symbolSize: function(val) {
	            return val[2] / 8;
	        },
	        itemStyle: {
	            normal: {
	                color: color[i]
	            }
	        },
	        data: item[1].map(function(dataItem) {
	            return {
	                name: dataItem[1].name,
	                value: geoCoordMap[dataItem[1].name].concat([dataItem[1].value])
	            };
	        })
	    });
	});
	
	option = {
	    backgroundColor: '#404a59',
	    title: {
	        text: '璐х墿娴佸悜',
	        /*subtext: '鏁版嵁绾睘铏氭瀯',*/
	        left: 'center',
	        textStyle: {
	            color: '#fff'
	        }
	    },
	    tooltip: {
	        trigger: 'item'
	    },
	    /*legend: {
	        orient: 'vertical',
	        top: 'bottom',
	        left: 'right',
	        data: ['鍖椾含 Top10', '涓婃捣 Top10', '骞垮窞 Top10'],
	        textStyle: {
	            color: '#fff'
	        },
	        selectedMode: 'single'
	    },*/
	    geo: {
	        map: 'china',
	        label: {
	            emphasis: {
	                show: false
	            }
	        },
	        roam: true,
	        itemStyle: {
	            normal: {
	                areaColor: '#323c48',
	                borderColor: '#404a59'
	            },
	            emphasis: {
	                areaColor: '#2a333d'
	            }
	        }
	    },
	    series: series
	};

	if (option && typeof option === "object") {
		myChart.setOption(option, true);
	}

	var sales = new CountUp("sales", 0, parseInt('${totalOrderAmount!0}'));
	sales.start();
    var orderTotal = new CountUp("order-total", 0, parseInt('${totalOrderCount!0}'));
	orderTotal.start();
</#macro>

<@layout>
<section>

	<div class="bi-body">
	    <div class="location">
	        <i class="icon-map-marker txt-color-green"></i> 婀栧寳鐪�> 姝︽眽甯�> 娲北鍖�
	    </div>
	    <div class="map-wrapper">
	    	<div id="map" class="maps"></div>
	    </div>
	    <div class="map-desc">
	    	鍥� 璐х墿娴佸悜鍥�
	    </div>

	    <div class="title">
	    	<h3>閿�敭姹囨�</h3>
	    </div>
        <div class="sales-gather">
            <div class="gather">
                <img src="${CTPATH}/images/money.png">
                <p>
                    鎬婚攢鍞(鍏�:<br/><span id="sales"></span>
                </p>
                <div class="clearfix"></div>
            </div>
            <div class="gather">
                <img src="${CTPATH}/images/order.png">
                <p>
                    璁㈠崟鎬绘暟(绗�:<br/><span id="order-total"></span>
                </p>
                <div class="clearfix"></div>
            </div>
        </div>

	    <div class="title">
	    	<h3>缁熻绫诲埆</h3>
	    </div>
	    <div class="weui-grids">
	        <a href="${CPATH}/renderSales" class="weui-grid js_grid">
	            <div class="weui-grid__icon" style="text-align: center">
	                <span class="icon-help2 classify-icon" style="color: orangered;font-size: 10vw;text-align: center;"></span>
				</div>
	            <p class="weui-grid__label">
	                	閿�敭
	            </p>
	            </a>
	            <a href="" class="weui-grid js_grid">
	                <div class="weui-grid__icon" style="text-align: center">
	                    <span class="icon-group" style="color: lightskyblue; font-size: 10vw;"></span>
	                </div>
	                <p class="weui-grid__label">
	                   	 瀹㈡埛
	                </p>
	            </a>
	            <a href="" class="weui-grid js_grid">
	                <div class="weui-grid__icon" style="text-align: center">
	                    <span class="icon-box2" style="color: greenyellow; font-size: 10vw;"></span>
	                </div>
	                <p class="weui-grid__label">
	                    	浜у搧
	                </p>
	            </a>
	        </div>
	        <div class="weui-footer">
	            <p class="weui-footer__text">姝︽眽甯傜張鐮斾俊鎭鎶�湁闄愬叕鍙�/p>
	        </div>
	    </div>
	</div>
</section>
</@layout>