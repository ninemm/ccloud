<#include "../_inc/_layout.html"/>

<#macro script_import>
	<!-- bootstrapvalidator -->
 	<script src="${CPATH}/static/plugins/bootstrapvalidator/bootstrapValidator.js"></script>
 	<script src="${CPATH}/static/ladda/spin.min.js"></script>
	<script src="${CPATH}/static/ladda/ladda.min.js"></script>
	<script src="${CPATH}/static/plugins/datetimepicker/bootstrap-datetimepicker.min.js"></script>
	<script src="${CPATH}/static/plugins/datetimepicker/bootstrap-datetimepicker.zh-CN.js"></script>
	<script src="${CPATH}/static/terminal/js/terminal.js"></script>
</#macro>

<#macro css_import>
	<!-- bootstrapvalidator -->
    <link rel="stylesheet" href="${CPATH}/static/plugins/bootstrapvalidator/bootstrapValidator.css">
    <link rel="stylesheet" href="${CPATH}/static/ladda/ladda-themeless.min.css">
    <link rel="stylesheet" href="${CPATH}/static/terminal/css/terminal.css">
</#macro>
<#macro css>
/* Demo CSS for the window, not needed for the basic terminal.js */
#terminal-window{
	max-width: 1000px;
	margin: 1em auto;
	box-shadow: 0 12px 24px rgba(0,0,0,.66);
}

#terminal-window::before{
	content: "console";
	color: #dfdbd2;
	font-weight: bold;
	font-size: 14px;

	padding-top: 6px;
	padding-left: 12px;

	max-width: 1000px;
	display: block;
	height: 22px;

	background-color: #3c3b37;
	background-image: linear-gradient(to bottom, #59574f, #3f3e3a);
	box-shadow: 0 1px 0 #58574e inset,
		         0 2px 0 #626055 inset;

	border-radius: 6px 6px 0 0;
}

#terminal{
	padding: 2px;
	font-size: 17px;
}
 </#macro> 
<#macro script>

var $form = $("#form");

$(function() {
	jQuery.mm.initDatetimepicker(null, '#purchaseTime', 'purchaseTime', 'yyyy-MM-dd', 2, 4, 2);

	$("#synchronize_category").on("click", function() {
		$(".ladda-button").attr("disabled","disabled");
		$("#consoleTest").append("<span class='result' data-terminal='line' data-terminal-message='&nbsp;&nbsp;同步产品分类中..................' data-terminal-time='0'></span>");
		runTerminalLinePrint($("#consoleTest span:last"),$('#terminal'));		
		$form.attr("action", "${CPATH}/admin/jp/info/synchronize/pullGoodsCategories");
		$form.ajaxSubmit({		
			type : "post", 
			dataType : "json", 
			success : function(data) {
				$(".ladda-button").removeAttr("disabled","disabled");
				$("#consoleTest").append("<span class='result' data-terminal='line' data-terminal-message='' data-terminal-time='0'></span>");
				if (data.errorCode == 0) {
					var size = data.data;
					$("#consoleTest span:last").data("terminalMessage", "&nbsp;&nbsp;商品分类同步成功,一共同步"+size+"种分类信息!");
				} else {
					$("#consoleTest span:last").data("terminalMessage", "&nbsp;&nbsp;商品分类同步失败");
				}
				runTerminalLinePrint($("#consoleTest span:last"),$('#terminal'));
			},
			error : function() {
				$(".ladda-button").removeAttr("disabled","disabled");
				alert("商品类别同步失败");
			}
		});
	});
	
	$("#synchronize_product").on("click", function() {
		$(".ladda-button").attr("disabled","disabled");
		$("#consoleTest").append("<span class='result' data-terminal='line' data-terminal-message='&nbsp;&nbsp;同步产品信息中..................' data-terminal-time='0'></span>");
		runTerminalLinePrint($("#consoleTest span:last"),$('#terminal'));		
		$form.attr("action", "${CPATH}/admin/jp/info/synchronize/pullProducts");
		$form.ajaxSubmit({		
			type : "post", 
			dataType : "json", 
			success : function(data) { 
				$(".ladda-button").removeAttr("disabled","disabled");
				$("#consoleTest").append("<span class='result' data-terminal='line' data-terminal-message='' data-terminal-time='0'></span>");
				if (data.errorCode == 0) {
					var data = data.data;
					$("#consoleTest span:last").data("terminalMessage", "&nbsp;&nbsp;"+data);
				} else {
					$("#consoleTest span:last").data("terminalMessage", '&nbsp;&nbsp;产品信息同步失败');
				}
				runTerminalLinePrint($("#consoleTest span:last"),$('#terminal'));
			},
			error : function() {
				$(".ladda-button").removeAttr("disabled","disabled");
				alert("产品信息同步失败");
			}
		});
	});
	
	$("#synchronize_seller").on("click", function() {
		$(".ladda-button").attr("disabled","disabled");
		$("#consoleTest").append("<span class='result' data-terminal='line' data-terminal-message='&nbsp;&nbsp;同步经销商信息中..................' data-terminal-time='0'></span>");
		runTerminalLinePrint($("#consoleTest span:last"),$('#terminal'));		
		$form.attr("action", "${CPATH}/admin/jp/info/synchronize/pullSellers");
		$form.ajaxSubmit({	
			type : "post", 
			dataType : "json", 
			success : function(data) { 
				$(".ladda-button").removeAttr("disabled","disabled");
				$("#consoleTest").append("<span class='result' data-terminal='line' data-terminal-message='' data-terminal-time='0'></span>");
				if (data.errorCode == 0) {
					var size = data.data;
					$("#consoleTest span:last").data("terminalMessage", "&nbsp;&nbsp;经销商信息同步成功,一共同步"+size+"家经销商信息!");
				} else {
					$("#consoleTest span:last").data("terminalMessage", "&nbsp;&nbsp;经销商信息同步失败");
				}
				runTerminalLinePrint($("#consoleTest span:last"),$('#terminal'));
			},
			error : function() {
				$(".ladda-button").removeAttr("disabled","disabled");
				alert('经销商信息同步失败');
			}
		});
	});
	
	$("#synchronize_seller_account").on("click", function() {
		$(".ladda-button").attr("disabled","disabled");
		$("#consoleTest").append("<span class='result' data-terminal='line' data-terminal-message='&nbsp;&nbsp;同步经销商账套信息中..................' data-terminal-time='0'></span>");
		runTerminalLinePrint($("#consoleTest span:last"),$('#terminal'));		
		$form.attr("action", "${CPATH}/admin/jp/info/synchronize/pullSellerAccounts");
		$form.ajaxSubmit({
			type : "post", 
			dataType : "json", 
			success : function(data) { 
				$(".ladda-button").removeAttr("disabled","disabled");
				$("#consoleTest").append("<span class='result' data-terminal='line' data-terminal-message='' data-terminal-time='0'></span>");
				if (data.errorCode == 0) {
					$("#consoleTest span:last").data("terminalMessage", "&nbsp;&nbsp;经销商账户同步成功,一共同步"+size+"个经销商账套!");
				} else {
					$("#consoleTest span:last").data("terminalMessage", "&nbsp;&nbsp;经销商账套同步失败！");
				}
				runTerminalLinePrint($("#consoleTest span:last"),$('#terminal'));
			},
			error : function() {
				$(".ladda-button").removeAttr("disabled","disabled");
				alert("经销商账套同步失败");
			}
		});
	});
	
	$("#synchronize_purchase_stockIn").on("click", function() {
		$(".ladda-button").attr("disabled","disabled");
		$("#consoleTest").append("<span class='result' data-terminal='line' data-terminal-message='&nbsp;&nbsp;同步采购单中..................' data-terminal-time='0'></span>");
		runTerminalLinePrint($("#consoleTest span:last"),$('#terminal'));		
		$form.attr("action", "${CPATH}/admin/jp/info/synchronize/pullPurchaseStockIns");
		$form.ajaxSubmit({
			type : "post", 
			dataType : "json", 
			success : function(data) { 
				$(".ladda-button").removeAttr("disabled","disabled");
				if (data.errorCode == 0) {
					var info = data.data;
					if (info.length == 0) {
						$("#consoleTest").append("<span class='result' data-terminal='line' data-terminal-message='' data-terminal-time='0'></span>");
						$("#consoleTest span:last").data("terminalMessage", "&nbsp;&nbsp;无采购单数据");					
					} else {
						$.each(info, function(index, obj){
							var infoName = obj.sellerName
							var infoMess = obj.sellerCount;
							$("#consoleTest").append("<span class='result' data-terminal='line' data-terminal-message='' data-terminal-time='0'></span>");
							$("#consoleTest span:last").data("terminalMessage", "&nbsp;&nbsp;" + infoName + "已成功同步" + infoMess + "单采购单!");
						});						
					}
				} else {
					$("#consoleTest").append("<span class='result' data-terminal='line' data-terminal-message='' data-terminal-time='0'></span>");
					$("#consoleTest span:last").data("terminalMessage", "&nbsp;&nbsp;采购入库单同步失败！");
				}
				runTerminalLinePrint($("#consoleTest span:last"),$('#terminal'));
			},
			error : function() {
				$(".ladda-button").removeAttr("disabled","disabled");
				alert("采购入库单同步失败");
			}
		});
	});
});
</#macro>

<@layout active_id=p child_active_id=c>

<!-- Content Header (Page header) -->
<section class="content-header">
	<h1>劲牌信息</h1>
	<ol class="breadcrumb">
		<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
       	<li><a href="#">劲牌信息</a></li>
       	<li class="active">劲牌信息同步</li>
	</ol>
</section>
<!-- Main content -->
<section class="content">
	<div class="box box-default">
		<div class="box-header with-border">
			<h3 class="box-title">劲牌信息同步</h3>
			<div class="box-tools">
				<button type="button" class="btn btn-box-tool" data-widget="collapse">
					<i class="fa fa-minus"></i>
				</button>
			</div>
		</div>
		<form action="" method="post" id="form" class="form-horizontal" >
		<div class="box-footer"> 
			<button type="button" id="synchronize_category" class="btn btn-sm bg-olive btn-flat ladda-button" data-style="expand-right">商品分类</button>
			<button type="button" id="synchronize_product" class="btn btn-sm bg-olive btn-flat ladda-button" data-style="expand-right">产品信息</button>
			<button type="button" id="synchronize_seller" class="btn btn-sm bg-olive btn-flat ladda-button" data-style="expand-right">经销商信息</button>
			<button type="button" id="synchronize_seller_account" class="btn btn-sm bg-olive btn-flat ladda-button" data-style="expand-right">经销商账套</button>
		</div>
		
		<div class="box-body">
			<div class="form-group col-sm-12 validata-box">
				<label class="control-label col-sm-2">采购单时间:</label>
				<div class="input-group col-md-4 col-sm-10">
					<input class="form-control" id="purchaseTime" name="purchaseTime" value="" placeholder="采购单时间">
				</div>
			</div>
			<div class="form-group col-sm-12 validata-box">
				<label class="control-label col-sm-2">商品品种编号:</label>
				<div class="input-group col-md-4 col-sm-10">
					<input class="form-control" id="goodsType" name="goodsType" value="" placeholder="商品品种编号">
				</div>
			</div>
		</div>
		<div id="terminal-window">
			<div id="terminal" data-terminal-prompt="admin@同步信息输出:~$ ">
				<div id="consoleTest">
				</div>
				<div class="output">
					<span class="line">&nbsp;&nbsp;1.点击<商品分类>按钮同步商品分类</span>
					<span class="line">&nbsp;&nbsp;2.点击<产品信息>按钮同步产品</span>
					<span class="line">&nbsp;&nbsp;3.点击<经销商信息>按钮同步经销商信息</span>
					<span class="line">&nbsp;&nbsp;4.点击<经销商账套>按钮同步经销商子账套信息</span>
					<span class="line">&nbsp;&nbsp;注:先同步分类再同步产品</span>
					<span class="line">&nbsp;&nbsp;先经销商信息再同步子账套信息</span>
					<span class="line">&nbsp;&nbsp;采购单时间距今不可超过30天</span>
					<span class="line">&nbsp;&nbsp;第一次同步等待时间会稍久,请您耐心等待</span>
					<span class="line">&nbsp;&nbsp;商品分类code</span>
					<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;不填写:同步所有</span>
					<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;0:同步根分类</span>
					<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;1:同步保健酒</span>
					<span class="line">&nbsp;&nbsp;&nbsp;&nbsp;2:同步白酒</span>
				</div>
			</div>
		</div>		
		<div class="box-footer"> 
			<button type="button" id="synchronize_purchase_stockIn" class="btn btn-sm bg-olive btn-flat ladda-button" data-style="expand-right">采购入库单</button>
		</div>
	</form>
	</div>
</section>

</@layout>