<#include "../_inc/_layout.html"/> 

<#macro script>

function del(id) {
	jQuery.mm.del('${CPATH}/admin/productComposition/delete?ucode=${ucode}&id=' + id);
}

function batchAction() {
	var $form = $("#form");
	$form.attr("action", "${CPATH}/admin/productComposition/batchDelete?ucode=${ucode}&c=${c!}&p=${p!}");
	
	jQuery.mm.batchAction('#form', '请选择组合商品记录');
}

function group(id) {
	var productId = id;
	layer.open({
		title:"组合详情",
		type: 2, 
		area: ['40%', '40%'],
		content: '${CPATH}/admin/productComposition/getDetail?id='+productId
	});		
}
</#macro>

<@layout active_id=p child_active_id=c>

<section class="content-header">
	<h1>组合商品管理</h1>
	<ol class="breadcrumb">
		<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
       	<li><a href="#">经销商管理</a></li>
       	<li class="active">组合商品管理</li>
	</ol>
</section>
<!-- Main content -->
<section class="content">
	<div class="row content-row">
		<div class="jp-left">
		<@shiro.hasPermission name="/admin/productComposition/edit,/admin/all">
			<a href="${CPATH}/admin/productComposition/edit?c=${c!}&p=${p!}" class="btn btn-sm btn-primary btn-flat"><i class="fa fa-plus"></i> 新增 </a>
			<a href="javascript:void(0);" onclick="batchAction()" class="btn btn-sm btn-danger btn-flat"><i class="fa fa-remove"></i> 删除 </a>
		</@shiro.hasPermission>
		</div>
		<form class="form-horizontal" style="float: right" action="${CPATH}/admin/productComposition?c=${c!}&p=${p!}" method="post">
			<div class="input-group input-group-sm">
				<input id="post-search-input" class="form-control" type="search" value="${k!}" name="k" placeholder="搜索名称">&nbsp; 
				<input id="search-submit" class="btn btn-sm btn-primary btn-flat" type="submit" value="搜索">
			</div>
		</form>
	</div>
	<div class="box ">
		<div class="box-body jp-common-pad">
			<form action="" method="POST" id="form">
				<table class="table table-striped">
					<thead>
						<tr>
							<th style="width: 20px">
								<label class="jp-common-pad "> 
									<input class="jp-common-pad " id="dataItem" onclick="checkAll(this)" title="全选" type="checkbox">
								</label>
							</th>
							<th style="width: 20%">组合商品名称</th>
							<th>商品价格</th>
							<th>主商品规格</th>
							<th>主产品库存</th>
							<th>品类数量</th>
							<th>活动名称</th>
							<th>是否上架</th>
							<@shiro.hasPermission name="/admin/productComposition/edit,/admin/all">
							<th style="width: 20%">操作</th>
							</@shiro.hasPermission>
						</tr>
					</thead>
					<tbody>
						<#if page??> <#list page.getList() as bean>
						<tr class="jp-onmouse">
							<td>
								<label class="jp-common-pad"> 
									<input class="jp-common-pad" name="dataItem" type="checkbox" value="${(bean.parent_id)!}">
								</label>
							</td>
							<td>
								<a href="${CPATH}/admin/productComposition/edit?id=${bean.parent_id}&c=${c!}&p=${p!}">${bean.name!}</a>
							</td>
							<td>${bean.price?string(',###.00')}</td>
							<td>${bean.valueName!}</td>
							<td>${bean.store_count!}</td>
							<td>${bean.type_count+1!}</td>
							<td>${bean.act_name!}</td>
							<td>
								<#if bean.state! == 1>
									是
								<#else>
									否
								</#if>
							</td>
							<td>
							<@shiro.hasPermission name="/admin/productComposition/edit,/admin/all">
								<a href="${CPATH}/admin/productComposition/edit?id=${bean.parent_id}&c=${c!}&p=${p!}" class="btn btn-xs bg-olive btn-flat">编辑</a>
								<a href="javascript:void(0);" onclick="del('${bean.parent_id}')" class="btn btn-xs btn-danger btn-flat">删除</a>
							</@shiro.hasPermission>
								<a onclick="group('${bean.parent_id!}')" class="btn btn-xs btn-warning btn-flat">组合详情</a>
							</td>
						</tr>
						</#list> </#if>
					</tbody>
				</table>
			</form>
		</div>
		<!-- /.box-body -->
	</div>
	<!-- /.box -->

	<div class="cf">
		<div class="pull-right"><#include "../_inc/_paginate_wrapper.html" /></div>
	</div>
</section>	
</@layout>