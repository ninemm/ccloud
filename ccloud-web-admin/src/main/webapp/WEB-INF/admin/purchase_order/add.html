<#include "../_inc/_layout.html"/>

<#macro script_import>
	<!-- bootstrapValidator -->
	<script src="${CPATH}/static/plugins/bootstrapvalidator/bootstrapValidator.js"></script>
	<!-- select2 -->
	<script src="${CPATH}/static/plugins/select2/js/select2.js"></script>
	<!-- cityPicker -->
	<script src="${CPATH}/static/plugins/cityPicker/js/citydata.js"></script>
	<script src="${CPATH}/static/plugins/cityPicker/js/cityPicker-1.1.4.js"></script>
</#macro>

<#macro css_import>
	<!-- bootstrapValidator -->
	<link rel="stylesheet" href="${CPATH}/static/plugins/bootstrapvalidator/bootstrapValidator.css">
	<!-- select2 -->
	<link rel="stylesheet" href="${CPATH}/static/plugins/select2/css/select2.css">
	<!-- cityPicker -->
	<link rel="stylesheet" href="${CPATH}/static/plugins/cityPicker/css/city-picker.css">
</#macro>

<#macro script>

		

	
	
	
	$("#addProductButton").click(function(){
	    var table = $("#productTable");  
	    var tr= $("<tr>" +  
	        "<td >"+"<select id='selectProduct'></select>"+"</td>" +  
	        "<td>"+"<input type='text' name='' value='1'/>"+"</td>" + 
	        "<td>"+"</td>" + 
	        "<td>"+"</td>" + 
	        "<td>"+"</td>" + 
	        "<td>"+"</td>" + 
	        "<td>"+"</td>" + 
	        "<td>"+"</td>" + 
	        "<td>"+"</td>" +
	        "<td>"+"</td>" +  
	        "<td  align='center' onclick='deletetr(this)'><button type='button'  class='btn btn-xs btn-link' >"+"删除"+"</button></td></tr>");  
	    table.append(tr);  
	    $.ajax({
				url:"${CPATH}/admin/purchaseOrder/show_product",
				type:"post",
				dataType:"json",
				success:function(data){
					$.each(data,function(index, item) {
						var html='<option value="'+item.id+'">'+item.seller_name+'</option>';
						$("#selectProduct").append(html);
					});
				}
			});
	})

	function doSubmit(){
		$("#userProvinceText").val($("select[name='userProvinceId']").find("option:selected").text()); 
		$("#userCityText").val($("select[name='userCityId']").find("option:selected").text()); 
		$("#userDistrictText").val($("select[name='userDistrictId']").find("option:selected").text()); 
		
		var list = $("#brand_option").select2("val");
		var ids = "";
		if (list != null && list.length > 0) {
			ids = list.toString();
		}
	
		$form.ajaxSubmit({
			beforeSubmit: function() {
				var validate = $form.data('bootstrapValidator');
				validate.validate();
				return validate.isValid()
			},
			type : "post", 
			data : {
				"brandList":ids},
			dataType : "json", 
			success : function(data) { 
				if(data.errorCode == 0) {
					//location.reload();
					toastr.success(data.message, '操作成功');
				} else {
					toastr.error(data.message,'操作失败');
				}
			},
			error : function() {
				alert("信息提交错误");
			}
		});
	}
</#macro>

<@layout active_id=p child_active_id=c>

<!-- Content Header (Page header) -->
<section class="content-header">
	<h1>新增采购订单</h1>
	<ol class="breadcrumb">
		<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
	<li>采购订单</li>
		<li class="active">新增采购订单</li>
	</ol>
</section>
<!-- Main content -->
<section class="content">
	<div class="box box-default">
		<div class="box-header with-border">
			<h3 class="box-title">采购订单信息</h3>
			<div class="box-tools">
				<button type="button" class="btn btn-box-tool" data-widget="collapse">
					<i class="fa fa-minus"></i>
				</button>
			</div>
		</div>
		<div class="box">
		<form action="${CPATH}/admin/seller/save" method="post" id="form" class="form-horizontal" >
			<table id="productTable" class="table table-striped table-hover table-condensed">
				<tr>
					<td colspan="11">
						<input type="button" id="addProductButton" class="btn btn-default" value="添加货品" />
					</td>
				</tr>
				<tr>
					<td>
						产品名/规格
					</td>
					<td>
						销售价格
					</td>
					<td>
						采购数量
					</td>
					<td>
						采购金额
					</td>
					<td>
						税率
					</td>
					<td>
						税金
					</td>
					<td>
						价税合计
					</td>
					<td>
						已入仓库数量
					</td>
					<td>
						未入仓库数量
					</td>
					<td>
						排序
					</td>
					<td>
						操作
					</td>
				</tr>
				
			</table>
		</form>
		</div>
		<div class="box-footer"> 
			<button type="button" onclick="doSubmit()" class="btn btn-primary ladda-button" data-style="expand-right"><span class="ladda-label">保存更改</span></button>
			<input type="button" class="btn btn-primary" onclick="window.history.back(); return false;" value="返  回" hidefocus="true" />
		</div>
	</div>
</section>

</@layout>