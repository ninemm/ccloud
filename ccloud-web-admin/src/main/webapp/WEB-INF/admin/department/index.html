<#include "../_inc/_layout.html"/> 

<#macro script_import>
	
	<!-- bootstrap-table -->
 	<script src="${CPATH}/static/plugins/bootstrap-table/bootstrap-table.js"></script>
 	<script type="text/javascript" src="${CPATH}/static/plugins/bootstrap-treeview/js/bootstrap-treeview.js"></script>
 	<script src="${CPATH}/static/plugins/bootstrap-table/bootstrap-table-zh-CN.js"></script>
	
</#macro>

<#macro css_import>
	
	<!-- bootstrap-table-->
    <link rel="stylesheet" href="${CPATH}/static/plugins/bootstrap-table/bootstrap-table.css">
    <link rel="stylesheet" href="${CPATH}/static/plugins/goods/goods.css">
	<link rel="stylesheet" href="${CPATH}/static/plugins/bootstrap-treeview/css/bootstrap-treeview.css">
</#macro> 

<#macro script>

	$(function() {
        $('#treeview').treeview({
          color: "#428bca",
          expandIcon: 'glyphicon glyphicon-chevron-right',
          collapseIcon: 'glyphicon glyphicon-chevron-down',
          nodeIcon: 'glyphicon glyphicon-bookmark',
          data: JSON.parse('${treeData!}'),
          onNodeSelected: function(event, node) {
			$.ajax({
				url:"${CPATH}/admin/department/getAboutInfo",
				type:"post",
				data:{"id": node.tags[3]},
				dataType:"json",
				success:function(data) {
					var url = '${CPATH}/admin/department/getCustomer';
					jQuery.mm.initIconTreeView('#treeview-checkable-station', data.stationList, false, url);
					jQuery.mm.initIconTreeView('#treeview-checkable-role', data.roleList, false, url);
					jQuery.mm.initIconTreeView('#treeview-checkable-warehouse', data.wareHouseList, false, url);
					jQuery.mm.initIconTreeView('#treeview-checkable-seller', data.sellerList, false, url);
					jQuery.mm.initIconTreeView('#treeview-checkable-group', data.groupList, false, url);
					jQuery.mm.initIconTreeView('#treeview-checkable-type', data.customTypeList, false, url);
				}
			});
          }
        });	
	});	

	function batchAction(status) {
		var status = status;
		let nodes = $('#treeview').treeview("getSelected", 0);
		if (nodes.length == 0) {// 未选中资源
			toastr.error("请先选择部门!",'提示');
			return ;
		}
		let deptId= nodes[0].tags[0];		
		if (status == 'edit') {
			location.href='${CPATH}/admin/department/edit?id=' + deptId + '&c=${c}&p=${p}';
		} else {
			jQuery.mm.del('${CPATH}/admin/department/delete?ucode=${ucode}&id=' + deptId);
		}
		
	}

</#macro>

<@layout active_id=p child_active_id=c>

<section class="content-header">
	<h1>组织机构</h1>
	<ol class="breadcrumb">
		<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
       	<li>用户权限</li>
       	<li class="active">组织机构</li>
	</ol>
</section>
<!-- Main content -->
<section class="content">
	<div class="row content-row">
		<div class="jp-left">
		<@shiro.hasPermission name="/admin/department/edit,/admin/all">
			<a href="${CPATH}/admin/department/edit?c=${c!}&p=${p!}" class="btn btn-sm btn-primary btn-flat"><i class="fa fa-plus"></i> 新增 </a>
			<a href="javascript:void(0);" onclick="batchAction('edit')" class="btn btn-sm btn-primary btn-flat"><i class="fa fa-remove"></i> 编辑 </a>
			<a href="javascript:void(0);" onclick="batchAction('del')" class="btn btn-sm btn-danger btn-flat"><i class="fa fa-remove"></i> 删除 </a>
		</@shiro.hasPermission>
		</div>
		<form class="form-horizontal" style="float: right" action="${CPATH}/admin/department?c=${c!}&p=${p!}" method="post">
		</form>
	</div>
	<div class="box">
	<table class="inputTable tabContent">
		<tr>
			<td colspan="2">
				<table class="inputTable goodsSpecificationTable">
					<tr>
						<th style="width: 30%;padding-left:10px">
							部门
						</th>
						<th style="width: 30%;padding-left:10px">
							用户
						</th>
						<th style="width: 20%;padding-left:10px">
							部门信息
						</th>						
					</tr>
					<tr>
						<td>
							<div class="goodsSpecificationArea" style="height:400px;">
								<div class="col-sm-20" style="padding:0">
							    	<div id="treeview" class=""></div>
							    </div>
							</div>
						</td>
						<td>
							<div id="goodsSpecificationPreview" class="goodsSpecificationPreview" style="height:400px;">
							    <ul id="myTab" class="nav nav-tabs">  
							        <li class="active"><a href="#A1" data-toggle="tab">角色人员</a></li>  
							        <li><a href="#B1" data-toggle="tab">岗位人员</a></li>  
							    </ul>
							    <div id="myTabContent" class="tab-content">  
							        <div class="tab-pane fade in active" id="A1">
								        <div class="col-sm-20">
								          <div id="treeview-checkable-role" class=""></div>
								        </div>							        	
							   		</div>
							        <div class="tab-pane fade" id="B1">
								        <div class="col-sm-20">
								          <div id="treeview-checkable-station" class=""></div>
								        </div>							        
							   		</div>
							   	</div>								    							
							</div>
						</td>
						<td>
							<div class="goodsSpecificationArea" style="height:400px;">
							    <ul id="myTab" class="nav nav-tabs">  
							        <li class="active"><a href="#A" data-toggle="tab">分组</a></li>  
							        <li><a href="#B" data-toggle="tab">仓库</a></li>  
							        <li><a href="#C" data-toggle="tab">账套</a></li>
							        <li><a href="#D" data-toggle="tab">客户类型</a></li>
							        <li><a href="#E" data-toggle="tab">客户</a></li>
							    </ul>
							    <div id="myTabContent" class="tab-content">  
							        <div class="tab-pane fade in active" id="A">
								        <div class="col-sm-20">
								          <div id="treeview-checkable-group" class=""></div>
								        </div>							        
							   		</div>
							        <div class="tab-pane fade" id="B">
								        <div class="col-sm-20">
								          <div id="treeview-checkable-warehouse" class=""></div>
								        </div>
							   		</div>
							        <div class="tab-pane fade" id="C">
								        <div class="col-sm-20">
								          <div id="treeview-checkable-seller" class=""></div>
								        </div>							        
							   		</div>
							        <div class="tab-pane fade" id="D">
								        <div class="col-sm-20">
								          <div id="treeview-checkable-type" class=""></div>
								        </div>							        
							   		</div>
							        <div class="tab-pane fade" id="E">
								        <div class="col-sm-20">
								          <div id="treeview-checkable-custom" class=""></div>
								        </div>							        	
							   		</div>								   								   									   									   		
							   	</div>						    						
							</div>
						</td>						
					</tr>
				</table>
			</td>
		</tr>
		</table>	
	</div>	    
</section>

</@layout>