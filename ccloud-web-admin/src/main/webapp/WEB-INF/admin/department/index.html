<#include "../_inc/_layout.html"/> 

<#macro script_import>
	
	<!-- bootstrap-table -->
 	<script src="${CPATH}/static/plugins/bootstrap-table/bootstrap-table.js"></script>
 	<script type="text/javascript" src="${CPATH}/static/plugins/bootstrap-treeview/js/bootstrap-treeview.js"></script>
 	<script src="${CPATH}/static/plugins/bootstrap-table/bootstrap-table-zh-CN.js"></script>
	
</#macro>

<#macro css_import>
	
	<!-- bootstrap-table-->
    <link rel="stylesheet" href="${CPATH}/static/plugins/bootstrap-table/bootstrap-table.css">
    <link rel="stylesheet" href="${CPATH}/static/plugins/goods/goods.css">
	<link rel="stylesheet" href="${CPATH}/static/plugins/bootstrap-treeview/css/bootstrap-treeview.css">
</#macro> 

<#macro css>
    .box_height {
        max-height: 600px;
        overflow-y: scroll;
    }
    
    ::-webkit-scrollbar {
          width: 1px;
    } /* 这是针对缺省样式 (必须的) */
</#macro>

<#macro script>

	$(function() {
        $('#treeview').treeview({
          color: "#428bca",
          expandIcon: 'glyphicon glyphicon-chevron-right',
          collapseIcon: 'glyphicon glyphicon-chevron-down',
          nodeIcon: 'glyphicon glyphicon-bookmark',
          data: JSON.parse('${treeData!}'),
          onNodeSelected: function(event, node) {
			$.ajax({
				url:"${CPATH}/admin/department/getAboutInfo",
				type:"post",
				data:{"id": node.tags[0]},
				dataType:"json",
				success:function(data) {
					var url = '${CPATH}/admin/department/getCustomer';
					jQuery.mm.initIconTreeView('#treeview-checkable-station', data.stationList, false, url);
					jQuery.mm.initIconTreeView('#treeview-checkable-role', data.roleList, false, url);
					jQuery.mm.initIconTreeView('#treeview-checkable-warehouse', data.wareHouseList, false, url);
					jQuery.mm.initIconTreeView('#treeview-checkable-user', data.userList, false, url);
					jQuery.mm.initIconTreeView('#treeview-checkable-seller', data.sellerList, false, url);
					jQuery.mm.initIconTreeView('#treeview-checkable-group', data.groupList, false, url);
					jQuery.mm.initIconTreeView('#treeview-checkable-type', data.customTypeList, false, url);
				}
			});
          }
        });	
	});	

	function batchAction(status) {
		var status = status;
		let nodes = $('#treeview').treeview("getSelected", 0);
		if (nodes.length == 0) {// 未选中资源
			toastr.error("请先选择部门!",'提示');
			return ;
		}
		let deptId= nodes[0].tags[0];		
		if (status == 'edit') {
			location.href='${CPATH}/admin/department/edit?id=' + deptId + '&c=${c}&p=${p}';
		} else {
			jQuery.mm.del('${CPATH}/admin/department/delete?ucode=${ucode}&id=' + deptId);
		}
		
	}

</#macro>

<@layout active_id=p child_active_id=c>

<section class="content-header">
	<h1>组织机构</h1>
	<ol class="breadcrumb">
		<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
       	<li>用户权限</li>
       	<li class="active">组织机构</li>
	</ol>
</section>
<!-- Main content -->
<section class="content">
	<div class="row content-row">
		<div class="jp-left">
		<@shiro.hasPermission name="/admin/department/edit,/admin/all">
			<a href="${CPATH}/admin/department/edit?c=${c!}&p=${p!}" class="btn btn-sm btn-primary btn-flat"><i class="fa fa-plus"></i> 新增 </a>
			<a href="javascript:void(0);" onclick="batchAction('edit')" class="btn btn-sm btn-primary btn-flat"><i class="fa fa-remove"></i> 编辑 </a>
			<a href="javascript:void(0);" onclick="batchAction('del')" class="btn btn-sm btn-danger btn-flat"><i class="fa fa-remove"></i> 删除 </a>
		</@shiro.hasPermission>
		</div>
		<form class="form-horizontal" style="float: right" action="${CPATH}/admin/department?c=${c!}&p=${p!}" method="post">
		</form>
	</div>
	
	<div class="row">
	    <div class="col-md-4 col-xs-12 box_height">
	        <div class="box box-primary">
	            <div class="box-header with-border">
	                <h3 class="box-title">部门</h3>
	                <div class="box-body">
	                    <div id="treeview" class=""></div>
	                </div>
	            </div>
	        </div>
	    </div>
	    
	    <div class="col-md-4 col-xs-12 no-padding box_height">
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">用户</h3>
                    <div class="box-body">
	                    <div class=" nav-tabs-custom">
	                        <ul class="nav nav-tabs">
	                            <li class="active"><a href="#C1" data-toggle="tab">部门人员</a></li>  
	                            <li><a href="#A1" data-toggle="tab">角色人员</a></li>  
	                            <li><a href="#B1" data-toggle="tab">岗位人员</a></li>
	                        </ul>
	                        <div class="tab-content">
	                            <div class="tab-pane fade in active" id="C1">
	                                <div id="treeview-checkable-user"></div>
	                            </div>                              
	                            <div class="tab-pane fade" id="A1">
	                                <div id="treeview-checkable-role"></div>
	                            </div>
	                            <div class="tab-pane fade" id="B1">
	                                <div id="treeview-checkable-station"></div>
	                            </div>
	                        </div>
	                    </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-4 col-xs-12 box_height">
            <div class="box box-primary">
                <div class="box-header with-border">
                    <h3 class="box-title">部门信息</h3>
                    <div class="box-body nav-tabs-custom">
                        <ul class="nav nav-tabs">
                            <li class="active"><a href="#A" data-toggle="tab">分组</a></li>  
                            <li><a href="#B" data-toggle="tab">仓库</a></li>  
                            <li><a href="#C" data-toggle="tab">账套</a></li>
                            <li><a href="#D" data-toggle="tab">客户类型</a></li>
                            <li><a href="#E" data-toggle="tab">客户</a></li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane active" id="A">
                                <div id="treeview-checkable-group"></div>
                            </div>                              
                            <div class="tab-pane fade" id="B">
                                <div id="treeview-checkable-warehouse"></div>
                            </div>
                            <div class="tab-pane fade" id="C">
                                <div id="treeview-checkable-seller"></div>
                            </div>
                            <div class="tab-pane fade" id="D">
                                <div id="treeview-checkable-type"></div>
                            </div>
                            <div class="tab-pane fade" id="E">
                                <div id="treeview-checkable-custom"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
	</div>
</section>

</@layout>