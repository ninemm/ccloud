<#include "../_inc/_layout.html"/> 

<#macro script>

function del(id) {
	jQuery.mm.del('${CPATH}/admin/user/delete?ucode=${ucode}&id=' + id);
}

function enable(obj,id) {
	$.ajax({
		url:"${CPATH}/admin/user/enable",
		type:"post",
		data:{"id":id},
		dataType:"json",
		success:function(data) {
			if(data.errorCode == 0) {
				toastr.success(data.message, '操作成功');
				if ($(obj).html() == "停用") {
					$(obj).html("启用");
				} else {
					$(obj).html("停用");
				}
			} else {
				toastr.error(data.message,'操作失败');
			}			
		}
	});
}

function batchAction() {
	var $form = $("#form");
	$form.attr("action", "${CPATH}/admin/user/batchDelete?ucode=${ucode}&c=${c!}&p=${p!}");
	
	jQuery.mm.batchAction('#form', '请选择系统记录');
}
</#macro>

<@layout active_id=p child_active_id=c>

<section class="content-header">
	<h1>用户管理</h1>
	<ol class="breadcrumb">
		<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
       	<li><a href="#">用户权限</a></li>
       	<li class="active">用户管理</li>
	</ol>
</section>
<!-- Main content -->
<section class="content">
	<div class="row content-row">
		<div class="jp-left">
			<a href="${CPATH}/admin/user/edit?c=${c!}&p=${p!}" class="btn btn-sm btn-primary btn-flat"><i class="fa fa-plus"></i> 新增 </a>
			<a href="javascript:void(0);" onclick="batchAction()" class="btn btn-sm btn-danger btn-flat"><i class="fa fa-remove"></i> 删除 </a>
		</div>
		<form class="form-horizontal" style="float: right" action="${CPATH}/admin/user?c=${c!}&p=${p!}" method="post">
			<div class="input-group input-group-sm">
				<input id="post-search-input" class="form-control" type="search" value="${k!}" name="k" placeholder="搜索名称">&nbsp; 
				<input id="search-submit" class="btn btn-default btn-sm btn-flat" type="submit" value="搜索">
			</div>
		</form>
	</div>
	
	<div class="box ">
		<!-- /.box-header -->
		<div class="box-body jp-common-pad">
			<form action="" method="POST" id="form">
				<table class="table table-striped">
					<thead>
						<tr>
							<th style="width: 20px">
								<label class="jp-common-pad "> 
									<input class="jp-common-pad " id="dataItem" onclick="checkAll(this)" title="全选" type="checkbox">
								</label>
							</th>
							<th>用户名</th>
							<th>真实姓名</th>
							<th>昵称</th>
							<th>手机</th>							
							<th>是否停用</th>
							<th>所属部门</th>
							<th>岗位</th>
							<th>分组</th>
						</tr>
					</thead>
					<tbody>
						<#if page??> <#list page.getList() as bean>
						<tr class="jp-onmouse">
							<td>
								<label class="jp-common-pad"> 
									<input class="jp-common-pad" name="dataItem" type="checkbox" value="${(bean.id)!}">
								</label>
							</td>
							<td>
								<a href="${CPATH}/admin/user/edit?id=${bean.id}&c=${c!}&p=${p!}">${bean.username!}</a>
							</td>
							<td>${bean.realname!}</td>
							<td>${bean.nickname!}</td>
							<td>${bean.mobile!}</td>
							<td><#if bean.status == 0>是<#else>否</#if></td>
							<td>${bean.department_name!}</td>
							<td>${bean.station_name!}</td>
							<td>${bean.group_name!}</td>
							
							<td>
								<a href="${CPATH}/admin/user/edit?id=${bean.id}&c=${c!}&p=${p!}" class="btn btn-xs bg-olive btn-flat">编辑</a>
								<a href="javascript:void(0);" onclick="del('${bean.id}')" class="btn btn-xs btn-danger btn-flat">删除</a>
								<a href="javascript:void(0);" onclick="enable(this,'${bean.id}')" class="btn btn-xs btn-info btn-flat"><#if bean.status == 1>停用<#else>启用</#if></a>
							</td>
						</tr>
						</#list> </#if>
					</tbody>
				</table>
			</form>
		</div>
		<!-- /.box-body -->
	</div>
	<!-- /.box -->

	<div class="cf">
		<div class="pull-right"><#include "../_inc/_paginate_wrapper.html" /></div>
	</div>
</section>	
</@layout>