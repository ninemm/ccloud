<#include "../_inc/_layout.html"/>

<#macro script_import>
	<!-- bootstrapvalidator -->
 	<script src="${CPATH}/static/plugins/bootstrapvalidator/bootstrapValidator.js"></script>
</#macro>

<#macro css_import>
	<!-- bootstrapvalidator -->
    <link rel="stylesheet" href="${CPATH}/static/plugins/bootstrapvalidator/bootstrapValidator.css">
</#macro>
 
<#macro script>

var $form = $("#form");
var dataCheck = false;

$(function() {
	
	jQuery.mm.initValidator('#form', validatorFields)
	
});

var validatorFields = {
	'supplier.name': {
		validators: {
            notEmpty: { message: '供应商名称不能为空' },
            stringLength: { max: 15, message: '系统名称最大长度是15字符，请重新输入' }
        }
	},
	'supplier.code': {
		validators: {
			notEmpty: { message: '供应商编码不能为空' },
			regexp:{regexp:/^[\d|a-zA-Z]{6}$/, message:'请确认录入6位字母或数字的供应商编码' }

        }
	},
	'supplier.is_enable': {
		validators: {
			notEmpty: { message: '请选择启用状态' },
        }
	},
	'supplier.mobile': {
		validators: {
			notEmpty: { message: '手机号不能为空' },
			regexp:{regexp:/^1[3|4|5|7|8]{1}[0-9]{9}$/, message:'请输入正确的手机号码' }
        }     
	}
};

function doSubmit(){
	$form.ajaxSubmit({
		beforeSubmit: function() {
			var validate = $form.data('bootstrapValidator');
			validate.validate();
			return validate.isValid();
		},
		type : "post", 
		dataType : "json", 
		success : function(data) { 
			if (data.errorCode == 0) {
				//location.reload();
				toastr.success(data.message, '操作成功');
			} else {
				toastr.error(data.message,'操作失败');
			}
		},
		error : function() {
			alert("信息提交错误");
		}
	});
}
	$('input[name="supplier.code"]').on("blur",function(){
		var supplierCode = $('input[name="supplier.code"]').val();
		var reg = /^[\d|a-zA-Z]{6}$/;
		if(reg.test(supplierCode)){
			$.ajax({
				url: '${CPATH}/admin/supplier/searchByCode',
				type: 'post',
				data: {code: supplierCode},
				success: function (result) {
					dataCheck = result.data;
					if(!dataCheck){
						$("button.btn-primary").attr("disabled", true);
						$('input[name="supplier.code"]').parent().append('<small class="help-block" data-bv-validator="regexp" name="small-codeCheck" data-bv-for="supplier.code" data-bv-result="INVALID" style="">当前供应商编码重复</small>');
						$('input[name="supplier.code"]').parent().removeClass("has-success");
						$('input[name="supplier.code"]').parent().addClass("has-error");
						$('input[name="supplier.code"]').parent().siblings("i").removeClass("glyphicon-ok");
						$('input[name="supplier.code"]').parent().siblings("i").addClass("glyphicon-remove");
						$('input[name="supplier.code"]').parent().parent().removeClass("has-success");
						$('input[name="supplier.code"]').parent().parent().addClass("has-error");
					}else{
						$("button.btn-primary").attr("disabled", false);
						$('small[name="small-codeCheck"]').remove();
					}
				}
			});
		}else{
			$("button.btn-primary").attr("disabled", false);
			$('small[name="small-codeCheck"]').remove();
		}
	});
	$('input[name="supplier.code"]').on("focus",function(){
		$("button.btn-primary").attr("disabled", false);
		$('small[name="small-codeCheck"]').remove();
	});
</#macro>

<@layout active_id=p child_active_id=c>

<!-- Content Header (Page header) -->
<section class="content-header">
	<h1><#if (supplier.id) ??>修改<#else>新增</#if>供应商信息</h1>
	<ol class="breadcrumb">
		<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
       	<li><a href="#">商品管理</a></li>
       	<li class="active"><#if (supplier.id) ??>修改<#else>新增</#if>供应商信息</li>
	</ol>
</section>
<!-- Main content -->
<section class="content">
	<div class="box box-default">
		<div class="box-header with-border">
			<h3 class="box-title">供应商信息</h3>
			<div class="box-tools">
				<button type="button" class="btn btn-box-tool" data-widget="collapse">
					<i class="fa fa-minus"></i>
				</button>
			</div>
		</div>
		<form action="${CPATH}/admin/supplier/save" method="post" id="form" class="form-horizontal" >
		<input type="hidden" name="supplier.id" value="${(supplier.id)!}">
		<div class="box-body">
			<div class="col-sm-12 ">
				<div class="row">
					<div class="form-group col-sm-12 validata-box">
						<label class="control-label col-sm-2">名称:</label>
						<div class="input-group col-md-4 col-sm-10">
		                 	<input class="form-control input-sm" type="text" name="supplier.name" value="${(supplier.name)!}" placeholder="1-15个任意字符">
		               	</div>
					</div>
					<div class="form-group col-sm-12 validata-box">
						<label class="control-label col-sm-2">编号:</label>
						<div class="input-group col-md-4 col-sm-10">
		                 	<input class="form-control input-sm" type="text" name="supplier.code" value="${(supplier.code)!}" placeholder="6个任意字母数字">
		               	</div>
					</div>
					<div class="form-group col-sm-12 validata-box">
						<label class="control-label col-sm-2">联系人:</label>
						<div class="input-group col-md-4 col-sm-10">
		                 	<input class="form-control input-sm" type="text" name="supplier.contact" value="${(supplier.contact)!}" placeholder="2-20个任意字母数字">
		               	</div>
					</div>
					<div class="form-group col-sm-12 validata-box">
						<label class="control-label col-sm-2">电话:</label>
						<div class="input-group col-md-4 col-sm-10">
		                 	<input class="form-control input-sm" type="text" name="supplier.mobile" value="${(supplier.mobile)!}" placeholder="2-20个任意字母数字">
		               	</div>
					</div>
					<div class="form-group col-sm-12 validata-box">
						<label class="control-label col-sm-2">qq:</label>
						<div class="input-group col-md-4 col-sm-10">
		                 	<input class="form-control input-sm" type="text" name="supplier.qq" value="${(supplier.qq)!}" placeholder="2-20个任意字母数字">
		               	</div>
					</div>
					<div class="form-group col-sm-12 validata-box">
						<label class="control-label col-sm-2">微信:</label>
						<div class="input-group col-md-4 col-sm-10">
		                 	<input class="form-control input-sm" type="text" name="supplier.wechat" value="${(supplier.wechat)!}" placeholder="2-20个任意字母数字">
		               	</div>
					</div>																				
					<div class="form-group col-sm-12 validata-box">
						<label class="control-label col-sm-2">供应商状态:</label>
						<div class="input-group col-md-4 col-sm-10">
							<label class="radio-inline">
		                 		<input type="radio" name="supplier.is_enable" value="1" <#if !supplier?? || supplier.isEnable == 1>checked</#if>>启用
		                 	</label>
		                 	<label class="radio-inline">
		                 		<input type="radio" name="supplier.is_enable" value="0" <#if supplier?? && supplier.isEnable == 0>checked</#if>>停用
							</label>		                 		
		               	</div>
					</div>
				</div>
			</div>
		</div>
	
		<div class="box-footer"> 
			<button type="button" onclick="doSubmit()" class="btn btn-primary">保存更改</button>
			<input type="button" class="btn btn-primary" onclick="window.history.back(); return false;" value="返  回" hidefocus="true" />
		</div>
	</form>
	</div>
</section>

</@layout>