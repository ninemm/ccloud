<#include "../_inc/_layout.html"/> 
<#macro css>
	.zh {
		text-align:center;
		vertical-align:middle !important;
	}
</#macro>
<#macro script>

	function changeCheckbox(obj){
		var operation = $(obj)[0];
		var url;
		if (operation.checked) {
			url = '${CPATH}/admin/station_operation_rel/save?station_id=${id}&operation_id=' + operation.value;
		}
		else {
			url = '${CPATH}/admin/station_operation_rel/delete?station_id=${id}&operation_id=' + operation.value;
		}
		$.ajax({
			url:url,
			type:"post",
			dataType:"json",
			success : function(data) {
				if(data.errorCode == 0) {
					toastr.success(data.message, '操作成功');
				} else {
					toastr.error(data.message,'操作失败');
				}
			},
			error : function() {
				alert("信息提交错误");
			}
		});
	}
	
</#macro>

<@layout active_id=p child_active_id=c>

<section class="content-header">
	<h1>岗位权限管理(${station_name!})</h1>
	<ol class="breadcrumb">
		<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
       	<li><a href="#">用户权限</a></li>
       	<li class="active">岗位权限管理</li>
	</ol>
</section>
<!-- Main content -->
<section class="content">
	<div class="row content-row">
		<div class="jp-left">
		</div>
	</div>
	<div class="box ">
		<div class="box-body jp-common-pad">
			<table class="table table-striped">
				<thead>
					<tr>
						<th class="zh" style="width: 20%">系统名称</th>
						<th class="zh">父模块名称</th>
						<th>模块名称</th>
						<th style="width:50%">权限名称</th>
					</tr>
				</thead>
				<tbody>
					<#list moduleList as bean>
					    <#if bean.systemName??>  
					    	<tr>
						        <td rowspan="${bean.systemRowSpan}" class="zh">${bean.systemName}</td>
						        <td rowspan="${bean.parentRowSpan}" class="zh">${bean.parentModuleName}</td>
						        <td>${bean.moduleName}</td>
						        <td>
									<#list bean.list as operation>
										<input type="checkbox" name="operationList" id="operaionList" <#if operation.isChecked == 1>checked</#if> value='${operation.operationCode!}' onchange="changeCheckbox(this)">
										${operation.operationName!}
									</#list>
						        </td>
					    	</tr>
					    <#elseif bean.parentModuleName??>  
					    	<tr>
						        <td rowspan="${bean.parentRowSpan}" class="zh">${bean.parentModuleName}</td>
						        <td>${bean.moduleName}</td>
						        <td>
									<#list bean.list as operation>
										<input type="checkbox" name="operationList" id="operaionList" <#if operation.isChecked == 1>checked</#if> value='${operation.operationCode!}' onchange="changeCheckbox(this)">
										${operation.operationName!}
									</#list>
						        </td>
					    	</tr>					    
					    <#else>  
					    	<tr>
						        <td>${bean.moduleName}</td>
						        <td>
									<#list bean.list as operation>
										<input type="checkbox" name="operationList" id="operaionList" <#if operation.isChecked == 1>checked</#if> value='${operation.operationCode!}' onchange="changeCheckbox(this)">
										${operation.operationName!}
									</#list>
						        </td>
					    	</tr>					        
					    </#if>  											
					</#list>
				</tbody>
			</table>
		</div>
	</div>

	<div class="cf">
		<div class="pull-right"><#include "../_inc/_paginate_wrapper.html" /></div>
	</div>
</section>	
</@layout>