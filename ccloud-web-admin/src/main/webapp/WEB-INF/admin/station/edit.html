<#include "../_inc/_layout.html"/>

<#macro script_import>
	<!-- bootstrapvalidator -->
 	<script src="${CPATH}/static/plugins/bootstrapvalidator/bootstrapValidator.js"></script>
 	<script src="${CPATH}/static/ladda/spin.min.js"></script>
	<script src="${CPATH}/static/ladda/ladda.min.js"></script>
</#macro>

<#macro css_import>
	<!-- bootstrapvalidator -->
    <link rel="stylesheet" href="${CPATH}/static/plugins/bootstrapvalidator/bootstrapValidator.css">
    <link rel="stylesheet" href="${CPATH}/static/ladda/ladda-themeless.min.css">
</#macro>

<#macro script>

var $form = $("#form");

$(function() {

	jQuery.mm.initValidator('#form', validatorFields);

	$('#_station_tree').click(function() {
	layer.open({
	title:'岗位资源',
	type: 2,
	area: ['580px', '530px'],
	fix: false, //不固定
	content: '${CPATH}/admin/station/station_tree'
	});
	});

});

var validatorFields = {
	'station.station_name': {
		validators: {
            notEmpty: { message: '岗位名称不能为空' },
            stringLength: { max: 15, message: '岗位名称最大长度是15字符，请重新输入' }
        }
	},
	'parentName': {
		validators: {
			notEmpty: { message: '上级岗位不能为空' }
		}
	},
	'station.order_list': {
		validators: {
			notEmpty: { message: '序号不能为空' },
			integer: {message: '请输入正整数'}
		}
	}
};

function doSubmit(){
	var l = Ladda.create( document.querySelector( '#do_submit' ) );
	$form.ajaxSubmit({
		beforeSubmit: function() {
			var validate = $form.data('bootstrapValidator');
			validate.validate();
			if (validate.isValid()) {
					l.start();
				}
			return validate.isValid();
		},
		type : "post",
		dataType : "json",
		success : function(data) {
			if(data.errorCode == 0) {
				//location.reload();
				toastr.success(data.message, '操作成功');
				
			} else {
				toastr.error(data.message,'操作失败');
			}
			setTimeout( function(){
						l.stop();
								}, 1 * 1000 );
		},
		error : function() {
			l.stop();
			alert("信息提交错误");
		}
	});
}
</#macro>
<#macro css>
	.input-group-addon {
	cursor: pointer;
	padding: 6px 4px;
	}
</#macro>
<@layout active_id=p child_active_id=c>

<!-- Content Header (Page header) -->
<section class="content-header">
	<h1><#if (station.id) ??>修改<#else>新增</#if>岗位信息</h1>
	<ol class="breadcrumb">
		<li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
       	<li><a href="#">用户权限</a></li>
       	<li class="active"><#if (station.id) ??>修改<#else>新增</#if>岗位信息</li>
	</ol>
</section>
<!-- Main content -->
<section class="content">
	<div class="box box-default">
		<div class="box-header with-border">
			<h3 class="box-title">岗位信息</h3>
			<div class="box-tools">
				<button type="button" class="btn btn-box-tool" data-widget="collapse">
					<i class="fa fa-minus"></i>
				</button>
			</div>
		</div>
		<form action="${CPATH}/admin/station/save" method="post" id="form" class="form-horizontal" >
		<input type="hidden" name="station.id" value="${(station.id)!}">
		<input type="hidden" name="ucode" value="${(ucode)!}">
		<div class="box-body">
			<div class="col-sm-12 ">
				<div class="row">
					<div class="form-group col-sm-12 validata-box">
						<label class="control-label col-sm-2">名称:</label>
						<div class="input-group col-md-4 col-sm-10">
		                 	<input class="form-control input-sm" type="text" name="station.station_name" value="${(station.station_name)!}" placeholder="1-15个任意字符">
		               	</div>
					</div>
					<div class="form-group col-sm-12 validata-box">
						<label class="control-label col-sm-2">上级岗位:</label>
						<div class="input-group col-md-4 col-sm-10">
							<div class="input-group">
								<input type="hidden" name="station.parent_id" id="parent_id" value="${(station.parentId)!}">
								<input class="form-control input-sm" type="text" id="parent_name" name="parentName" value="${(station.parent_name)!}" placeholder="请选择上级岗位"readonly>
								<!-- <a href="javascript:void(0);" onclick="grant();" class="btn btn-primary btn-sm">选择</a> -->
								<div class="input-group-addon" id="_station_tree">
									<i class="fa fa-search"></i> 选择
								</div>
							</div>
						</div>
					</div>
					<div class="form-group col-sm-12">
						<label class="control-label col-sm-2">排序:</label>
						<div class="input-group col-md-4 col-sm-10">
		                 	<input class="form-control input-sm" type="number" name="station.order_list" value="${(station.order_list)!10}">
		               	</div>
					</div>
          <div class="form-group col-sm-12">
						<label class="control-label col-sm-2">描述:</label>
						<div class="input-group col-md-4 col-sm-10">
		                 	<textarea class="form-control input-sm" type="text" name="station.description" value="${(station.description)!}"></textarea>
		               	</div>
					</div>
				</div>
			</div>
		</div>

		<div class="box-footer">
			<button type="button" id="do_submit" onclick="doSubmit()" class="btn btn-sm bg-olive btn-flat ladda-button" data-style="expand-right">保存更改</button>
			<input type="button" class="btn btn-sm btn-primary btn-flat" onclick="window.history.back(); return false;" value="返  回" hidefocus="true" />
		</div>
	</form>
	</div>
</section>

</@layout>
