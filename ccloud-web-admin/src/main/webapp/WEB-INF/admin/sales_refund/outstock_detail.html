<#include "../_inc/_layer_layout.html"/>

<#macro script_import>
	<script type="text/javascript" src="${CPATH}/static/plugins/bootstrap-treeview/js/bootstrap-treeview.js"></script>
	<!-- <script src="${CPATH}/static/plugins/toastr/toastr.js"></script> -->
</#macro> 

<#macro css_import>
	<link rel="stylesheet" href="${CPATH}/static/plugins/bootstrap-treeview/css/bootstrap-treeview.css">
	<!-- <link rel="stylesheet" href="${CPATH}/static/plugins/toastr/toastr.css"> -->
</#macro>

<#macro script>
	$(document).ready(function() {
		
		<@shiro.hasRole name="021"> 
			var total_amount=0;
    			<#list outstockDetail as detail>
				<#if detail.is_gift?? && detail.is_gift == 1>
					total_amount=total_amount;
				<#else>
					total_amount=total_amount+${(detail.tax_price*detail.product_count / detail.convert_relate)}
				</#if>
			</#list>
			$("#total_amount").text("￥"+total_amount.toFixed(2));
    		</@shiro.hasRole>	
    		<@shiro.lacksRole name="021"> 
			$("#total_amount").text("￥"+formatNumber(${(outstock.total_amount)!}));
    		</@shiro.lacksRole>	
		
		$(".subtotal").each(function(){
    			$(this).text($(this).data("value").toFixed(2));
    		});
	});

</#macro>

<@layout>
<div style="padding: 10px;">
	<div class="row">
		<div class="col-xs-12" style="margin-top: 20px;">
			<span class="pull-left">
			单号：${(outstock.outstock_sn)!}
			</br>
			状态：${(outstock.status)!} 
			</span>
			<span class="pull-right">
			下单人员：${(outstock.realname)!}/ ${(outstock.mobile)!} 
			<br/> 
			创建时间：${(outstock.create_date)!}
			</span>
		</div>
		<table class="table table-striped table-hover table-condensed text-center" >
			<thead>
				<tr>
					<th>序号</th>
					<th>商品</th>
					<th>大单位数量</th>
					<th>小单位数量</th>
					<th>是否赠品</th>
					<th>小计</th>
				</tr>
			</thead>
			<tbody>
				<#list outstockDetail as detail>
					<tr>
						<td>${detail_index + 1}</td>
						<td>${detail.custom_name!}</td>
						<td>${(detail.product_count / detail.convert_relate)?floor} ${detail.big_unit + ' (x' + detail.convert_relate + detail.small_unit + ')' }</td>
						<td>${detail.product_count % detail.convert_relate} ${detail.small_unit}</td>
						<td><#if detail.is_gift?? && detail.is_gift == 1>是</#if></td>
						<@shiro.hasRole name="021"> 
							<td>￥ <#if detail.is_gift?? && detail.is_gift == 1>0<#else><span class="subtotal" data-value="${(detail.tax_price *detail.product_count / detail.convert_relate)}"></span></#if></td>
						</@shiro.hasRole>	
    						<@shiro.lacksRole name="021"> 
							<td>￥ ${detail.product_amount!}</td>
    						</@shiro.lacksRole>	
					</tr>
				</#list>
			</tbody>
			<tfoot>
				<tr>
					<th colspan="5" style="text-align:right">合计:</th>
					<th id = "total_amount"></th>
				</tr>
			</tfoot>
		</table>

		<div id="customer">
			<div class="form-group col-sm-12 validata-box">
				<label class="control-label col-sm-2">客户名称:</label>
				<div class="input-group col-md-4 col-sm-10">
					<span class="control-span"> ${(outstock.customer_name)!} </span>
				</div>
			</div>
			<div class="form-group col-sm-12 validata-box">
				<label class="control-label col-sm-2">联系人:</label>
				<div class="input-group col-md-4 col-sm-10">
					<span class="control-span"> ${(outstock.ccontact)!} </span>
				</div>
			</div>
			<div class="form-group col-sm-12 validata-box">
				<label class="control-label col-sm-2">手机号:</label>
				<div class="input-group col-md-4 col-sm-10">
					<span class="control-span"> ${(outstock.cmobile)!} </span>
				</div>
			</div>
			<div class="form-group col-sm-12 validata-box">
				<label class="control-label col-sm-2">客户类型:</label>
				<div class="input-group col-md-4 col-sm-10">
					<span class="control-span"> ${(outstock.customerTypeName)!} </span>
				</div>
			</div>
			<div class="form-group col-sm-12 validata-box">
				<label class="control-label col-sm-2">配送地址:</label>
				<div class="input-group col-md-4 col-sm-10">
					<span class="control-span"> ${(outstock.delivery_address)!} </span>
				</div>
			</div>
			<div class="form-group col-sm-12 validata-box">
				<label class="control-label col-sm-2">配送时间:</label>
				<div class="input-group col-md-4 col-sm-10">
					<span class="control-span"> ${(outstock.delivery_date)!} </span>
				</div>
			</div>
			<div class="form-group col-sm-12 validata-box">
				<label class="control-label col-sm-2">收款方式:</label>
				<div class="input-group col-md-4 col-sm-10">
					<span class="control-span"> <#if outstock.receive_type == 1>现金<#else>应收账款</#if> </span>
				</div>
			</div>
			<div class="form-group col-sm-12 validata-box">
				<label class="control-label col-sm-2">备注:</label>
				<div class="input-group col-md-4 col-sm-10">
					<span class="control-span" > ${(outstock.remark)!} </span>
				</div>
			</div>
		</div>
	</div>
</div>	
</@layout>